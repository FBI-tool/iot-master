<a (click)="edit()">
  <i nz-icon nzType="plus"></i>
  添加
</a>

<nz-row [nzGutter]="[8,8]" cdkDropList (cdkDropListDropped)="drop($event)">
  <div nz-col [nzSpan]="12" [nzXs]="24" [nzSm]="12" [nzMd]="12" [nzLg]="8" [nzXl]="6" [nzXXl]="4"
       *ngFor="let data of items; let i=index" cdkDrag>
    <nz-card nzSize="small" nzHoverable
             [nzTitle]="data.label" [nzExtra]="extraTemplate" (click)="edit(data)">
      <p>
        {{data.name}}
        <span *ngIf="data.le">小端</span>
        <span *ngIf="data.store">保存</span>
      </p>
      <p>
        {{data.code}}{{data.address}}
        {{data.type}}
        <span *ngIf="data.precision">精度：{{data.precision}}</span>
      </p>
    </nz-card>
    <ng-template #extraTemplate>
      <a title="移动" cdkDragHandle>
        <i nz-icon nzType="drag" nzTheme="outline"></i>
      </a>
      <nz-divider nzType="vertical"></nz-divider>
      <a title="复制" (click)="copy(i); $event.stopPropagation()">
        <i nz-icon nzType="copy" nzTheme="outline"></i>
      </a>
      <nz-divider nzType="vertical"></nz-divider>
      <a title="删除" nz-popconfirm nzPopconfirmTitle="确定删除?" (nzOnConfirm)="remove(i)" (click)="$event.stopPropagation()">
        <i nz-icon nzType="delete" nzTheme="outline"></i>
      </a>
    </ng-template>
  </div>
</nz-row>

<nz-modal [(nzVisible)]="showModal" nzTitle="编辑数据点" (nzOnOk)="onOk()" (nzOnCancel)="showModal=false">
  <ng-container *nzModalContent>
    <form [formGroup]="formGroup" (change)="change()">
      <nz-form-item>
        <nz-form-label [nzSpan]="5">变量</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <input nz-input formControlName="name" (ngModelChange)="change()" (change)="change()" required/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">名称</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <input nz-input formControlName="label" (ngModelChange)="change()" (change)="change()" required/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">单位</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <input nz-input formControlName="unit" (ngModelChange)="change()" (change)="change()" required/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">代码</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <nz-select formControlName="code" nzSize="small" (ngModelChange)="change()" (change)="change()" required>
            <nz-option [nzValue]="code.name" [nzLabel]="code.label" *ngFor="let code of codes"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">地址</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <input nz-input formControlName="address" nzSize="small" (ngModelChange)="change()" (change)="change()"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">类型</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <nz-select formControlName="type" nzSize="small" (ngModelChange)="change()" (change)="change()" required>
            <nz-option nzValue="bit" nzLabel="位"></nz-option>
            <nz-option nzValue="byte" nzLabel="字节"></nz-option>
            <nz-option nzValue="word" nzLabel="字"></nz-option>
            <nz-option nzValue="dword" nzLabel="双字"></nz-option>
            <nz-option nzValue="qword" nzLabel="四字"></nz-option>
            <nz-option nzValue="short" nzLabel="短整型"></nz-option>
            <nz-option nzValue="int" nzLabel="整型"></nz-option>
            <nz-option nzValue="long" nzLabel="长整型"></nz-option>
            <nz-option nzValue="float" nzLabel="浮点数"></nz-option>
            <nz-option nzValue="double" nzLabel="双精度"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">小端模式</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <nz-switch formControlName="le" nzSize="small" (change)="change()" (ngModelChange)="change()"></nz-switch>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">小数位数</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <input nz-input formControlName="precision" nzSize="small" (change)="change()" (ngModelChange)="change()"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="5">保存历史</nz-form-label>
        <nz-form-control [nzSpan]="12" nzErrorTip="">
          <nz-switch formControlName="store" nzSize="small" (change)="change()" (ngModelChange)="change()"></nz-switch>
        </nz-form-control>
      </nz-form-item>

    </form>
  </ng-container>
</nz-modal>

