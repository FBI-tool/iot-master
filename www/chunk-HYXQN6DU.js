import{a as Ie}from"./chunk-OZXWHQAE.js";import{a as Ae}from"./chunk-O5VM4YCW.js";import{a as Re}from"./chunk-4TS6DFN4.js";import{a as Be}from"./chunk-2RC4YZJA.js";import{a as Xe,b as Ve}from"./chunk-5UFXXK45.js";import{a as Ge}from"./chunk-QBVGC53F.js";import{a as je}from"./chunk-B4M7IYJ2.js";import{c as ye,e as De,f as Ee,g as Ne,h as Fe,i as Pe}from"./chunk-EXT7S62Z.js";import"./chunk-Y6Y75R7J.js";import{a as ke,b as Oe,c as we}from"./chunk-BE4ZTW6G.js";import{a as B,b as X,c as Te,d as G,e as V,f as Me}from"./chunk-IT2U3YUS.js";import{Ba as se,Hb as ve,Ib as Ce,Ob as Se,Pb as be,Rb as _e,T as I,Tb as w,U as T,Ub as j,Vb as xe,ab as de,bb as ce,c as ie,cb as ue,db as ze,e as ne,eb as fe,f as oe,h as re,j as ae,lb as he,m as le,n as P,o as pe,ob as ge,p as me,tb as M,vb as k,xb as O}from"./chunk-FZUU2ZSO.js";import{Ca as n,Da as c,Kb as Y,La as l,Sa as h,Sb as Z,Ta as i,Tb as ee,Ua as o,Va as d,Z as _,Za as b,a as q,b as U,ba as x,bb as f,ca as y,d as W,db as v,fc as N,ga as C,gb as Q,ha as S,hb as p,hc as F,ib as u,ic as te,jb as D,kc as H,lb as E,mb as K,qb as A,rb as R,va as J}from"./chunk-Q2QJEMPV.js";function Qe(m,a){m&1&&(i(0,"button",22),p(1,"\u7F16\u8F91"),o())}function Ke(m,a){if(m&1){let s=b();i(0,"button",23),f("nzOnConfirm",function(){C(s);let t=v();return S(t.delete())}),p(1," \u5220\u9664 "),o()}}function Ye(m,a){if(m&1){let s=b();i(0,"div",24),f("click",function(){let r=C(s).index,z=v();return S(z.toLink(r))}),d(1,"img",25),i(2,"span"),p(3),o()()}if(m&2){let s=a.$implicit;l("title",s.description),n(1),l("src",s.icon,J),n(2),D(" ",s.name," ")}}function Ze(m,a){if(m&1&&(i(0,"nz-col",26)(1,"div",27),d(2,"nz-statistic",28),o()()),m&2){let s=a.$implicit,e=v();l("nzXs",12)("nzSm",8)("nzMd",6)("nzLg",4)("nzXl",3)("nzXXl",2),n(2),l("nzTitle",s.label)("nzValue",e.values[s.name]||"-")("nzSuffix",s.unit)}}function et(m,a){m&1&&(i(0,"a",31),d(1,"i",32),o())}function tt(m,a){if(m&1&&(i(0,"tr")(1,"td"),p(2),o(),i(3,"td"),p(4),o(),i(5,"td"),p(6),o(),i(7,"td",29),p(8),A(9,"date"),o(),i(10,"td")(11,"nz-space"),h(12,et,2,0,"a",30),o()()()),m&2){let s=a.$implicit;n(2),u(s.level),n(2),u(s.title),n(2),u(s.message),n(1),l("title",s.created),n(1),u(R(9,5,s.created))}}var it=()=>[4,4],He=(()=>{let a=class a{constructor(e,t,r,z,g){this.fb=e,this.router=t,this.msg=r,this.rs=z,this.route=g,this.itemId=[{label:"product_id",value:"\u4EA7\u54C1"},{label:"project_id",value:"\u9879\u76EE"},{label:"gateway_id",value:"\u7F51\u5173"}],this.data={},this.product={},this.properties=[{name:"temp",label:"\u6E29\u5EA6",unit:"\u2103"},{name:"hum",label:"\u6E7F\u5EA6",unit:"%"}],this.total=0,this.nzPageIndex=1,this.nzPageSize=10,this.value="",this.values={temp:30,hum:71},this.link=[{to:"product",name:"\u672A\u7ED1\u5B9A\u4EA7\u54C1",icon:"assets/app.png"},{to:"project",name:"\u672A\u7ED1\u5B9A\u9879\u76EE",icon:"assets/app.png"},{id:"modbus",name:"\u672A\u7ED1\u5B9A\u7F51\u5173",icon:"assets/app.png"}],this.plugins=[{id:"modbus",name:"Modbus",icon:"assets/app.png",description:"Modbus\u6620\u5C04\u7F16\u8F91"},{id:"history",name:"\u5386\u53F2\u6570\u636E",icon:"assets/app.png",description:""}],this.alarms=[]}ngOnInit(){if(this.route.snapshot.paramMap.has("id")){this.id=this.route.snapshot.paramMap.get("id"),this.load(),this.loadValues();return}}toLink(e){let t=this.data[this.itemId[e].label];t?this.router.navigateByUrl("/admin/"+this.link[e].to+"/"+t):this.msg.error("\u672A\u7ED1\u5B9A")}load(){this.rs.get(`device/${this.id}`,{}).subscribe(e=>{this.data=e.data,this.data&&this.itemId.filter((t,r)=>{this.link[r].name=(this.data?.[t.label]?"\u5DF2\u7ED1\u5B9A":"\u672A\u7ED1\u5B9A")+t.value}),this.loadProduct(),this.loadProperties()}),this.rs.get("alarm/list",{}).subscribe(e=>{this.alarms=e.data,this.total=e.total},e=>{console.log("err:",e)})}loadValues(){this.rs.get("device/"+this.id+"/values").subscribe(e=>{this.values=e.data})}loadProduct(){this.rs.get("product/"+this.data.product_id).subscribe(e=>{this.product=e.data})}loadProperties(){this.rs.get("product/"+this.data.product_id+"/attach/read/property.json").subscribe(e=>{console.log("property",e),this.properties=e})}nzPageSizeChange(e){this.nzPageSize=e,this.load()}nzPageIndexChange(e){this.nzPageIndex=e,this.load()}delete(){this.rs.get(`device/${this.id}/delete`,{}).subscribe(e=>{this.msg.success("\u5220\u9664\u6210\u529F"),this.router.navigateByUrl("admin/device")},e=>{console.log("err:",e)})}};a.\u0275fac=function(t){return new(t||a)(c(P),c(F),c(k),c(O),c(N))},a.\u0275cmp=x({type:a,selectors:[["app-device-detail"]],standalone:!0,features:[E],decls:49,vars:25,consts:[["nz-button","","routerLink","edit",4,"nzSpaceItem"],["nz-button","","nz-popconfirm","","nzPopconfirmTitle","\u786E\u8BA4\u5220\u9664",3,"nzOnConfirm",4,"nzSpaceItem"],["nzSize","small",3,"nzColumn"],["nzTitle","ID",3,"nzSpan"],["nzTitle","\u540D\u79F0",3,"nzSpan"],["nzTitle","\u7248\u672C",3,"nzSpan"],["nzTitle","\u521B\u5EFA\u65F6\u95F4",3,"nzSpan"],["nzTitle","\u8BF4\u660E",3,"nzSpan"],["nzText","\u94FE\u63A5","nzOrientation","left"],[1,"links"],["class","link",3,"title","click",4,"ngFor","ngForOf"],["nzText","\u63D2\u4EF6\u5217\u8868","nzOrientation","left"],[3,"plugins"],["nzText","\u5B9E\u65F6\u53D8\u91CF","nzOrientation","left"],[1,"variables",3,"nzGutter"],[3,"nzXs","nzSm","nzMd","nzLg","nzXl","nzXXl",4,"ngFor","ngForOf"],["nzText","\u544A\u8B66\u65E5\u5FD7","nzOrientation","left"],[3,"nzData","nzFrontPagination"],["table",""],[4,"ngFor","ngForOf"],[1,"pages"],["nzShowSizeChanger","","nzShowQuickJumper","",3,"nzPageIndex","nzPageSize","nzTotal","nzPageIndexChange","nzPageSizeChange"],["nz-button","","routerLink","edit"],["nz-button","","nz-popconfirm","","nzPopconfirmTitle","\u786E\u8BA4\u5220\u9664",3,"nzOnConfirm"],[1,"link",3,"title","click"],[3,"src"],[3,"nzXs","nzSm","nzMd","nzLg","nzXl","nzXXl"],[1,"variable"],[3,"nzTitle","nzValue","nzSuffix"],[3,"title"],["title","\u5220\u9664","nz-popconfirm","","nzPopconfirmTitle","\u786E\u8BA4\u5220\u9664",4,"nzSpaceItem"],["title","\u5220\u9664","nz-popconfirm","","nzPopconfirmTitle","\u786E\u8BA4\u5220\u9664"],["nz-icon","","nzType","delete"]],template:function(t,r){if(t&1&&(i(0,"nz-page-header")(1,"nz-page-header-title"),p(2,"\u8BBE\u5907\u8BE6\u60C5"),o(),i(3,"nz-page-header-subtitle"),p(4),o(),i(5,"nz-page-header-extra")(6,"nz-space"),h(7,Qe,2,0,"button",0)(8,Ke,2,0,"button",1),o()(),i(9,"nz-page-header-content")(10,"nz-descriptions",2)(11,"nz-descriptions-item",3),p(12),o(),i(13,"nz-descriptions-item",4),p(14),o(),i(15,"nz-descriptions-item",5),p(16),o(),i(17,"nz-descriptions-item",6),p(18),A(19,"date"),o(),i(20,"nz-descriptions-item",7),p(21),o()()()(),d(22,"nz-divider",8),i(23,"div",9),h(24,Ye,4,3,"div",10),o(),d(25,"nz-divider",11)(26,"app-plugins",12)(27,"nz-divider",13),i(28,"nz-row",14),h(29,Ze,3,9,"nz-col",15),o(),d(30,"nz-divider",16),i(31,"nz-table",17,18)(33,"thead")(34,"tr")(35,"th"),p(36,"\u7B49\u7EA7"),o(),i(37,"th"),p(38,"\u6807\u9898"),o(),i(39,"th"),p(40,"\u5185\u5BB9"),o(),i(41,"th"),p(42,"\u65F6\u95F4"),o(),i(43,"th"),p(44,"\u64CD\u4F5C"),o()()(),i(45,"tbody"),h(46,tt,13,7,"tr",19),o()(),i(47,"div",20)(48,"nz-pagination",21),f("nzPageIndexChange",function(g){return r.nzPageIndexChange(g)})("nzPageSizeChange",function(g){return r.nzPageSizeChange(g)}),o()()),t&2){let z=Q(32);n(4),u(r.data.name),n(6),l("nzColumn",3),n(1),l("nzSpan",1),n(1),u(r.data.id),n(1),l("nzSpan",1),n(1),u(r.data.name),n(1),l("nzSpan",1),n(1),u(r.data.version),n(1),l("nzSpan",1),n(1),u(R(19,22,r.data.created)),n(2),l("nzSpan",2),n(1),u(r.data.description),n(3),l("ngForOf",r.link),n(2),l("plugins",r.plugins),n(2),l("nzGutter",K(24,it)),n(1),l("ngForOf",r.properties),n(2),l("nzData",r.alarms)("nzFrontPagination",!1),n(15),l("ngForOf",z.data),n(2),l("nzPageIndex",r.nzPageIndex)("nzPageSize",r.nzPageSize)("nzTotal",r.total)}},dependencies:[Me,V,B,X,Te,G,we,Oe,ke,xe,j,w,je,M,se,Y,te,_e,Z,Be,I,T,Ge,be,ye,Ee,Ne,De,Pe,Fe],styles:[".variables[_ngcontent-%COMP%]   .variable[_ngcontent-%COMP%]{background-color:#fff;padding:10px;cursor:pointer;transition:box-swadow .3s,border-color .3s}.variables[_ngcontent-%COMP%]   .variable[_ngcontent-%COMP%]:hover{box-shadow:2px 2px 5px gray}.links[_ngcontent-%COMP%]{display:flex}.links[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{margin:10px;padding:10px;background-color:#fff;border-radius:5px;display:flex;flex-direction:column;align-items:center;cursor:pointer}.links[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:10px;width:60px;height:60px}"]});let m=a;return m})();function nt(m,a){if(m&1){let s=b();i(0,"button",9),f("click",function(){C(s);let t=v();return S(t.onSubmit())}),p(1,"\u4FDD\u5B58"),o()}}var $=(()=>{let a=class a{constructor(e,t,r,z,g,$e){this.fb=e,this.router=t,this.msg=r,this.rs=z,this.route=g,this.ms=$e,this.data={name:"\u65B0\u8BBE\u5907"},this.projectOption=[],this.productOption=[],this.product=[],this.gateway=[],this.filteredOptions=["Burns Bay Road","Downing Street","Wall Street"]}onInputChange(){console.log(this.formGroup.value.gateway_id)}buildFromGroup(e){e=e||{},this.formGroup=this.fb.group({id:[e.id||"",[]],name:[e.name||"",[]],description:[e.description||"",[]],gateway_id:[e.gateway_id||null,[]],product_id:[this.productOption[0]?.label||null,[]],project_id:[this.projectOption[0]?.label||null,[]],keywords:[e.keywords||[],[]]})}onChoose(e){switch(e){case 0:this.ms.create({nzTitle:"\u7F51\u5173\u9009\u62E9",nzCentered:!0,nzMaskClosable:!1,nzWidth:"800px",nzContent:Ae,nzFooter:null}).afterClose.subscribe(t=>{t&&this.formGroup.patchValue({gateway_id:t})});break;case 1:this.ms.create({nzTitle:"\u4EA7\u54C1\u9009\u62E9",nzCentered:!0,nzMaskClosable:!1,nzWidth:"800px",nzContent:Ie,nzFooter:null}).afterClose.subscribe(t=>{t&&(console.log(t),this.productOption=[{label:(t.name||"\u540D\u79F0\u4E3A\u7A7A")+" ("+(t.version||"\u7248\u672C\u53F7\u4E3A\u7A7A")+")",value:t.id}],this.formGroup.patchValue({product_id:this.productOption[0].label}))});break;case 2:this.ms.create({nzTitle:"\u9879\u76EE\u9009\u62E9",nzCentered:!0,nzMaskClosable:!1,nzWidth:"800px",nzContent:Re,nzFooter:null}).afterClose.subscribe(t=>{console.log(t),t&&(this.projectOption=[{label:t.name||"\u540D\u79F0\u4E3A\u7A7A",value:t.id}],this.formGroup.patchValue({project_id:this.projectOption[0].label}))});break;default:break}}ngOnInit(){this.route.snapshot.paramMap.has("id")&&(this.id=this.route.snapshot.paramMap.get("id"),this.load()),this.loadSelect(),this.buildFromGroup()}load(){this.rs.get(`device/${this.id}`,{}).subscribe(e=>W(this,null,function*(){e.data?.product_id&&this.rs.get(`product/${e.data.product_id}`).subscribe(t=>{if(t.data){let r=t.data;this.productOption=[{label:(r.name||"\u540D\u79F0\u4E3A\u7A7A")+" ("+(r.version||"\u7248\u672C\u53F7\u4E3A\u7A7A")+")",value:r.id}],this.formGroup.patchValue({product_id:this.productOption[0].label})}}),e.data?.project_id&&this.rs.get(`project/${e.data.project_id}`).subscribe(t=>{if(t.data){let r=t.data;this.projectOption=[{label:r.name||"\u540D\u79F0\u4E3A\u7A7A",value:r.id}],this.formGroup.patchValue({project_id:this.projectOption[0].label})}}),console.log(3),this.buildFromGroup(e.data)}),e=>{console.log("err:",e)})}loadSelect(){this.rs.post("gateway/search",{limit:9999}).subscribe(e=>{let t=[];e.data&&e.data.filter(r=>{t.push({label:r.name,value:r.id})}),this.gateway=t,console.log(this.gateway)},e=>{console.log("err:",e)}),this.rs.post("product/search",{limit:9999}).subscribe(e=>{let t=[];e.data&&e.data.filter(r=>{t.push({label:r.id,value:r.id})}),this.product=t},e=>{console.log("err:",e)})}onSubmit(){if(this.formGroup.valid){let e=U(q({},this.formGroup.value),{product_id:this.productOption[0]?.value,project_id:this.projectOption[0]?.value}),t=this.id?`device/${this.id}`:"device/create";this.rs.post(t,e).subscribe(r=>{this.router.navigateByUrl("admin/device"),this.msg.success("\u4FDD\u5B58\u6210\u529F")});return}else Object.values(this.formGroup.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))})}onIconChange(e){}};a.\u0275fac=function(t){return new(t||a)(c(P),c(F),c(k),c(O),c(N),c(ve))},a.\u0275cmp=x({type:a,selectors:[["app-device-edit"]],standalone:!0,features:[E],decls:46,vars:28,consts:[["nz-button","","nzType","primary",3,"click",4,"nzSpaceItem"],["nz-form","",3,"formGroup"],["nzFor","id",3,"nzSm","nzXs"],["nzErrorTip","",3,"nzSm","nzXs"],["nz-input","","formControlName","id","placeholder","\u9009\u586B\uFF0C\u9ED8\u8BA4\u968F\u673A"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nz-input","","formControlName","name"],["nzRequired","","nzFor","gateway_id",3,"nzSm","nzXs"],["nz-input","","formControlName","gateway_id"],["nz-button","","nzType","primary",3,"click"],["nzRequired","","nzFor","product_id",3,"nzSm","nzXs"],["nz-input","","formControlName","product_id"],["nzRequired","","nzFor","project_id",3,"nzSm","nzXs"],["nz-input","","formControlName","project_id"],["nzFor","description",3,"nzSm","nzXs"],[3,"nzMaxCharacterCount"],["rows","4","nz-input","","formControlName","description"]],template:function(t,r){t&1&&(i(0,"nz-page-header")(1,"nz-page-header-title"),p(2),o(),i(3,"nz-page-header-subtitle"),p(4),o(),i(5,"nz-page-header-extra")(6,"nz-space"),h(7,nt,2,0,"button",0),o()()(),i(8,"form",1)(9,"nz-form-item")(10,"nz-form-label",2),p(11,"ID"),o(),i(12,"nz-form-control",3),d(13,"input",4),o()(),i(14,"nz-form-item")(15,"nz-form-label",5),p(16,"\u540D\u79F0"),o(),i(17,"nz-form-control",3),d(18,"input",6),o()(),i(19,"nz-form-item")(20,"nz-form-label",7),p(21,"\u7F51\u5173"),o(),i(22,"nz-form-control",3),d(23,"input",8),i(24,"button",9),f("click",function(){return r.onChoose(0)}),p(25,"\u9009\u62E9"),o()()(),i(26,"nz-form-item")(27,"nz-form-label",10),p(28,"\u4EA7\u54C1"),o(),i(29,"nz-form-control",3),d(30,"input",11),i(31,"button",9),f("click",function(){return r.onChoose(1)}),p(32,"\u9009\u62E9"),o()()(),i(33,"nz-form-item")(34,"nz-form-label",12),p(35,"\u9879\u76EE"),o(),i(36,"nz-form-control",3),d(37,"input",13),i(38,"button",9),f("click",function(){return r.onChoose(2)}),p(39,"\u9009\u62E9"),o()()(),i(40,"nz-form-item")(41,"nz-form-label",14),p(42,"\u8BF4\u660E"),o(),i(43,"nz-form-control",3)(44,"nz-textarea-count",15),d(45,"textarea",16),o()()()()),t&2&&(n(2),D("\u8BBE\u5907",r.id?"\u7F16\u8F91":"\u521B\u5EFA",""),n(2),u(r.data.name),n(4),l("formGroup",r.formGroup),n(2),l("nzSm",6)("nzXs",24),n(2),l("nzSm",14)("nzXs",24),n(3),l("nzSm",6)("nzXs",24),n(2),l("nzSm",14)("nzXs",24),n(3),l("nzSm",6)("nzXs",24),n(2),l("nzSm",14)("nzXs",24),n(5),l("nzSm",6)("nzXs",24),n(2),l("nzSm",14)("nzXs",24),n(5),l("nzSm",6)("nzXs",24),n(2),l("nzSm",14)("nzXs",24),n(5),l("nzSm",6)("nzXs",24),n(2),l("nzSm",14)("nzXs",24),n(1),l("nzMaxCharacterCount",200))},dependencies:[Se,Ve,M,V,G,X,B,j,w,pe,re,ie,ne,oe,me,ae,le,fe,T,I,ce,de,ze,ue,he,ge],styles:["input[_ngcontent-%COMP%], .select[_ngcontent-%COMP%]{width:200px;margin-right:10px}"]});let m=a;return m})();var ot=[{path:"",component:Xe},{path:"create",component:$},{path:":id",component:He},{path:":id/edit",component:$}],Le=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=y({type:a}),a.\u0275inj=_({imports:[H.forChild(ot),H]});let m=a;return m})();var Wt=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=y({type:a}),a.\u0275inj=_({imports:[ee,Le,Ce]});let m=a;return m})();export{Wt as DeviceModule};
