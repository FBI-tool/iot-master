"use strict";(self.webpackChunkiot_master_ui=self.webpackChunkiot_master_ui||[]).push([[90],{423:(W,F,i)=>{i.d(F,{h:()=>j});var y=i(433),s=i(235),t=i(4650),e=i(4575),B=i(1445),d=i(9651),b=i(7423),A=i(3679),v=i(6704),M=i(5635),O=i(6616),E=i(7044),Z=i(1664),S=i(1206),P=i(6895),k=i(8e3),I=i(269),R=i(6903),$=i(7096),L=i(1243);function K(m,T){if(1&m&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&m){const r=T.$implicit;t.xp6(1),t.Oqu(r.label)}}function U(m,T){if(1&m){const r=t.EpF();t.TgZ(0,"nz-input-number",16),t.NdJ("nzBlur",function(){t.CHM(r);const x=t.oxw(3);return t.KtG(x.change())}),t.qZA()}if(2&m){const r=t.oxw().$implicit;t.Q6J("formControlName",r.name)("nzPlaceHolder",r.placeholder)}}function Q(m,T){if(1&m){const r=t.EpF();t.TgZ(0,"nz-select",17),t.NdJ("ngModelChange",function(){t.CHM(r);const x=t.oxw(3);return t.KtG(x.change())}),t.qZA()}if(2&m){const r=t.oxw().$implicit;t.Q6J("formControlName",r.name)("nzPlaceHolder",r.placeholder)("nzOptions",r.options)}}function J(m,T){if(1&m&&t._UZ(0,"nz-switch",18),2&m){const r=t.oxw().$implicit;t.Q6J("formControlName",r.name)}}function Y(m,T){if(1&m&&t._UZ(0,"nz-switch",18),2&m){const r=t.oxw().$implicit;t.Q6J("formControlName",r.name)}}function H(m,T){if(1&m){const r=t.EpF();t.TgZ(0,"input",19),t.NdJ("blur",function(){t.CHM(r);const x=t.oxw(3);return t.KtG(x.change())}),t.qZA()}if(2&m){const r=t.oxw().$implicit;t.Q6J("placeholder",r.placeholder||"")("formControlName",r.name)}}function g(m,T){if(1&m&&(t.TgZ(0,"td"),t.ynx(1,11),t.YNc(2,U,1,2,"nz-input-number",12),t.YNc(3,Q,1,3,"nz-select",13),t.YNc(4,J,1,1,"nz-switch",14),t.YNc(5,Y,1,1,"nz-switch",14),t.YNc(6,H,1,2,"input",15),t.BQk(),t.qZA()),2&m){const r=T.$implicit;t.xp6(1),t.Q6J("ngSwitch",r.type),t.xp6(1),t.Q6J("ngSwitchCase","number"),t.xp6(1),t.Q6J("ngSwitchCase","select"),t.xp6(1),t.Q6J("ngSwitchCase","switch"),t.xp6(1),t.Q6J("ngSwitchCase","bool")}}function u(m,T){1&m&&t._UZ(0,"span",20)}function c(m,T){if(1&m){const r=t.EpF();t.TgZ(0,"span",21),t.NdJ("click",function(){t.CHM(r);const x=t.oxw().index,N=t.oxw();return t.KtG(N.handleCopyProperTy(x))}),t.qZA()}}function n(m,T){if(1&m){const r=t.EpF();t.TgZ(0,"span",22),t.NdJ("click",function(){t.CHM(r);const x=t.oxw().index,N=t.oxw();return t.KtG(N.propertyDel(x))}),t.qZA()}}function _(m,T){if(1&m&&(t.TgZ(0,"tr",6),t.YNc(1,g,7,5,"td",3),t.TgZ(2,"td",7)(3,"nz-space"),t.YNc(4,u,1,0,"span",8),t.YNc(5,c,1,0,"span",9),t.YNc(6,n,1,0,"span",10),t.qZA()()()),2&m){const r=T.index,C=t.oxw();t.Q6J("formGroupName",r),t.xp6(1),t.Q6J("ngForOf",C._items)}}let h=(()=>{class m{set items(r){const C={};r.forEach(x=>{C[x.name]=x.default}),this.row=C,this._items=r}constructor(r,C){this.msg=r,this.fb=C,this.row={},this._items=[],this.onChanged=()=>{},this.onTouched=()=>{},this.data={}}ngOnInit(){this.formArray=this.fb.array([]),this.group=this.fb.group({array:this.formArray})}writeValue(r){const C=JSON.parse(JSON.stringify(this.row));r&&r.length&&r.forEach(x=>{const N=this.fb.group(Object.assign(C,x));this.formArray.push(N)})}registerOnChange(r){this.onChanged=r}registerOnTouched(r){this.onTouched=r}change(){const r=this.formArray.controls.map(C=>C.value);this.onChanged(r)}handleCopyProperTy(r){this.formArray.insert(r,this.fb.group(this.formArray.controls[r].value)),this.msg.success("\u590d\u5236\u6210\u529f"),this.change()}propertyDel(r){this.formArray.removeAt(r),this.change()}drop(r){(0,S.bA)(this.formArray.controls,r.previousIndex,r.currentIndex),this.change()}propertyAdd(){this.formArray.insert(0,this.fb.group(this.row))}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(d.dD),t.Y36(y.qu))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-edit-table"]],inputs:{data:"data",items:"items"},features:[t._Bn([{provide:y.JU,useExisting:(0,t.Gpc)(()=>m),multi:!0}])],decls:11,vars:3,consts:[["type","button","nz-button","","nzType","primary",3,"click"],["type","button","nz-icon","","nzType","plus"],["nzTemplateMode","",3,"formGroup"],[4,"ngFor","ngForOf"],["cdkDropList","","formArrayName","array",3,"cdkDropListDropped"],["cdkDrag","",3,"formGroupName",4,"ngFor","ngForOf"],["cdkDrag","",3,"formGroupName"],[1,"td-oper"],["nz-icon","","nzType","drag","nzTheme","outline","title","\u79fb\u52a8\u5f53\u524d\u884c","style","cursor:move;","cdkDragHandle","",4,"nzSpaceItem"],["nz-icon","","nzType","copy","nzTheme","outline","title","\u590d\u5236\u5f53\u524d\u884c","style","cursor:pointer;",3,"click",4,"nzSpaceItem"],["nz-icon","","nzType","delete","nzTheme","outline","title","\u5220\u9664","style","cursor:pointer;",3,"click",4,"nzSpaceItem"],[3,"ngSwitch"],[3,"formControlName","nzPlaceHolder","nzBlur",4,"ngSwitchCase"],[3,"formControlName","nzPlaceHolder","nzOptions","ngModelChange",4,"ngSwitchCase"],[3,"formControlName",4,"ngSwitchCase"],["nz-input","",3,"placeholder","formControlName","blur",4,"ngSwitchDefault"],[3,"formControlName","nzPlaceHolder","nzBlur"],[3,"formControlName","nzPlaceHolder","nzOptions","ngModelChange"],[3,"formControlName"],["nz-input","",3,"placeholder","formControlName","blur"],["nz-icon","","nzType","drag","nzTheme","outline","title","\u79fb\u52a8\u5f53\u524d\u884c","cdkDragHandle","",2,"cursor","move"],["nz-icon","","nzType","copy","nzTheme","outline","title","\u590d\u5236\u5f53\u524d\u884c",2,"cursor","pointer",3,"click"],["nz-icon","","nzType","delete","nzTheme","outline","title","\u5220\u9664",2,"cursor","pointer",3,"click"]],template:function(r,C){1&r&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return C.propertyAdd()}),t._UZ(1,"i",1),t._uU(2," \u6dfb\u52a0\n"),t.qZA(),t.TgZ(3,"nz-table",2)(4,"thead")(5,"tr"),t.YNc(6,K,2,1,"th",3),t.TgZ(7,"th"),t._uU(8,"\u64cd\u4f5c"),t.qZA()()(),t.TgZ(9,"tbody",4),t.NdJ("cdkDropListDropped",function(N){return C.drop(N)}),t.YNc(10,_,7,2,"tr",5),t.qZA()()),2&r&&(t.xp6(3),t.Q6J("formGroup",C.group),t.xp6(3),t.Q6J("ngForOf",C._items),t.xp6(4),t.Q6J("ngForOf",C.formArray.controls))},dependencies:[P.sg,P.RF,P.n9,P.ED,M.Zp,O.ix,E.w,Z.dQ,y.Fj,y.JJ,y.JL,y.sg,y.u,y.x0,y.CE,S.Wj,S.Zt,S.Bh,k.Vq,I.N8,I.Uo,I._C,I.Om,I.p0,I.$Z,b.Ls,R.NU,R.$1,$._V,L.i]}),m})();var f=i(9054),D=i(3224);function q(m,T){1&m&&(t.TgZ(0,"button",27),t._UZ(1,"i",28),t._uU(2," \u6dfb\u52a0 "),t.qZA())}function G(m,T){1&m&&(t.TgZ(0,"button",27),t._UZ(1,"i",28),t._uU(2," \u6dfb\u52a0 "),t.qZA())}let j=(()=>{class m{constructor(r,C,x,N){this.fb=r,this.router=C,this.rs=x,this.msg=N,this.listData=[{label:"\u540d\u79f0(ID)",name:"name"},{label:"\u663e\u793a",name:"label"},{label:"\u7c7b\u578b",name:"type",type:"select",default:"int",options:[{label:"\u6574\u6570",value:"int"},{label:"\u6d6e\u70b9\u6570",value:"float"},{label:"\u5e03\u5c14\u578b",value:"bool"},{label:"\u6587\u672c",value:"text"},{label:"\u679a\u4e3e",value:"enum"},{label:"\u6570\u7ec4",value:"array"},{label:"\u5bf9\u8c61",value:"object"}]},{label:"\u5355\u4f4d",name:"unit"},{label:"\u6a21\u5f0f",name:"mode",type:"select",default:"rw",options:[{label:"\u53ea\u8bfb",value:"r"},{label:"\u8bfb\u5199",value:"rw"}]}],this.parameterslistData=[{label:"\u540d\u79f0(ID)",name:"name"},{label:"\u663e\u793a",name:"label"},{label:"\u6700\u5927\u503c",name:"max",type:"number",default:0},{label:"\u6700\u5c0f\u503c",name:"min",type:"number",default:0},{label:"\u9ed8\u8ba4\u503c",name:"default",type:"number",default:0}],this.constraintslistData=[{label:"\u7b49\u7ea7",name:"level"},{label:"\u6807\u9898",name:"label"},{label:"\u6a21\u677f",name:"template"},{label:"\u8868\u8fbe\u5f0f",name:"expression"},{label:"\u62a5\u8b66\u5ef6\u8fdfs",name:"delay",type:"number"},{label:"\u518d\u6b21\u63d0\u9192",name:"repeat",type:"bool"},{label:"\u518d\u6b21\u63d0\u9192\u5ef6\u8fdfs",name:"repeat_delay",type:"number"},{label:"\u603b\u63d0\u9192\u6b21\u6570",name:"repeat_total",type:"number"}],this.validatorsListData=[{label:"\u6807\u9898",name:"title"},{label:"\u7b49\u7ea7",name:"level",type:"number",default:0},{label:"\u6a21\u677f",name:"template"},{label:"\u8868\u8fbe\u5f0f",name:"expression"},{label:"\u62a5\u8b66\u5ef6\u8fdfs",name:"delay",type:"number",default:5},{label:"\u518d\u6b21\u63d0\u9192",name:"repeat",type:"bool",default:!0},{label:"\u518d\u6b21\u63d0\u9192\u5ef6\u8fdfs",name:"repeat_delay",type:"number",default:300},{label:"\u603b\u63d0\u9192\u6b21\u6570",name:"repeat_total",type:"number",default:10}],this.aggregatorsListData=[{label:"\u5b9a\u65f6\u8ba1\u5212",name:"crontab"},{label:"\u8868\u8fbe\u5f0f",name:"expression"},{label:"\u7c7b\u578b",name:"type",type:"select",default:"inc",options:[{label:"\u589e\u52a0",value:"inc"},{label:"\u51cf\u5c11",value:"dec"},{label:"\u5e73\u5747",value:"avg"},{label:"\u8ba1\u6570",value:"count"},{label:"\u6700\u5c0f",value:"min"},{label:"\u6700\u5927",value:"max"},{label:"\u6c42\u5408",value:"sum"},{label:"\u6700\u540e",value:"last"},{label:"\u6700\u524d",value:"first"}]},{label:"\u8d4b\u503c",name:"assign"}]}ngOnInit(){this.id&&this.rs.get(`product/${this.id}`).subscribe(r=>{this.setData(r.data||{})}),this.build()}setData(r){const C=this.group.value;for(const x in C)r[x]&&(C[x]=r[x]);this.group.setValue(C)}build(r){this.group=this.fb.group({id:[(r=r||{}).id||"",[]],name:[r.name||"",[y.kI.required]],desc:[r.desc||"",[]],version:[r.version||"",[]],properties:[r.properties||[],[]],parameters:[r.parameters||[],[]],constraints:[r.constraints||[],[]],validators:[r.validators||[],[]],aggregators:[r.aggregators||[],[]]})}submit(){return new Promise(r=>{if(this.group.valid){let C=this.id?`product/${this.id}`:"product/create";const{desc:x}=this.group.value;if(x.length>200)return void this.msg.warning("\u3010\u8bf4\u660e\u3011\u5b57\u6570\u8fc7\u957f");this.rs.post(C,this.group.value).subscribe(N=>{this.msg.success("\u4fdd\u5b58\u6210\u529f"),r(!0)})}})}handleChange(r){"done"===r.file.status?this.msg.success(`${r.file.name} \u6587\u4ef6\u4e0a\u4f20\u6210\u529f`):"error"===r.file.status&&this.msg.error(`${r.file.name} \u6587\u4ef6\u4e0a\u4f20\u5931\u8d25.`)}handleCancel(){const r=`${(0,s.kh)()}/product/list`;this.router.navigateByUrl(r)}}return m.\u0275fac=function(r){return new(r||m)(t.Y36(y.qu),t.Y36(e.F0),t.Y36(B.s),t.Y36(d.dD))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-product-edit-component"]],inputs:{id:"id"},decls:47,vars:28,consts:[["nz-form","",3,"formGroup"],["nzFor","id",3,"nzSm","nzXs"],["nzErrorTip","",3,"nzSm","nzXs"],["nz-input","","formControlName","id","placeholder","\u9ed8\u8ba4\u4e3a\u968f\u673a\u751f\u6210"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nz-input","","formControlName","name"],["nzFor","version",3,"nzSm","nzXs"],["nz-input","","formControlName","version"],["nzFor","desc",3,"nzSm","nzXs"],[3,"nzMaxCharacterCount"],["rows","4","nz-input","","formControlName","desc"],[3,"nzSm","nzXs"],["nzAction","/",3,"nzChange"],["nz-button",""],["nz-icon","","nzType","upload"],["nzHeader","\u5c5e\u6027","nzActive",""],["formControlName","properties",3,"items"],["functionEx",""],["nzDisabled","","nzHeader","\u529f\u80fd",3,"nzExtra"],["eventEx",""],["nzDisabled","","nzHeader","\u4e8b\u4ef6",3,"nzExtra"],["nzHeader","\u53d8\u91cf"],["formControlName","parameters",3,"items"],["nzHeader","\u6570\u636e\u68c0\u67e5"],["formControlName","validators",3,"items"],["nzHeader","\u6570\u636e\u805a\u5408"],["formControlName","aggregators",3,"items"],["type","button","nz-button","","nzType","primary"],["nz-icon","","nzType","plus"]],template:function(r,C){if(1&r&&(t.TgZ(0,"form",0)(1,"nz-form-item")(2,"nz-form-label",1),t._uU(3,"ID"),t.qZA(),t.TgZ(4,"nz-form-control",2),t._UZ(5,"input",3),t.qZA()(),t.TgZ(6,"nz-form-item")(7,"nz-form-label",4),t._uU(8,"\u540d\u79f0"),t.qZA(),t.TgZ(9,"nz-form-control",2),t._UZ(10,"input",5),t.qZA()(),t.TgZ(11,"nz-form-item")(12,"nz-form-label",6),t._uU(13,"\u7248\u672c"),t.qZA(),t.TgZ(14,"nz-form-control",2),t._UZ(15,"input",7),t.qZA()(),t.TgZ(16,"nz-form-item")(17,"nz-form-label",8),t._uU(18,"\u8bf4\u660e"),t.qZA(),t.TgZ(19,"nz-form-control",2)(20,"nz-textarea-count",9),t._UZ(21,"textarea",10),t.qZA()()(),t.TgZ(22,"nz-form-item")(23,"nz-form-label",11),t._uU(24,"\u56fe\u7247\u4e0a\u4f20"),t.qZA(),t.TgZ(25,"nz-form-control",11)(26,"nz-upload",12),t.NdJ("nzChange",function(N){return C.handleChange(N)}),t.TgZ(27,"button",13),t._UZ(28,"span",14),t._uU(29," \u70b9\u51fb\u4e0a\u4f20 "),t.qZA()()()(),t.TgZ(30,"nz-collapse")(31,"nz-collapse-panel",15),t._UZ(32,"app-edit-table",16),t.qZA(),t.YNc(33,q,3,0,"ng-template",null,17,t.W1O),t.TgZ(35,"nz-collapse-panel",18),t._uU(36," \u6682\u4e0d\u652f\u6301 "),t.qZA(),t.YNc(37,G,3,0,"ng-template",null,19,t.W1O),t.TgZ(39,"nz-collapse-panel",20),t._uU(40," \u6682\u4e0d\u652f\u6301 "),t.qZA(),t.TgZ(41,"nz-collapse-panel",21),t._UZ(42,"app-edit-table",22),t.qZA(),t.TgZ(43,"nz-collapse-panel",23),t._UZ(44,"app-edit-table",24),t.qZA(),t.TgZ(45,"nz-collapse-panel",25),t._UZ(46,"app-edit-table",26),t.qZA()()()),2&r){const x=t.MAs(34),N=t.MAs(38);t.Q6J("formGroup",C.group),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMaxCharacterCount",200),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(7),t.Q6J("items",C.listData),t.xp6(3),t.Q6J("nzExtra",x),t.xp6(4),t.Q6J("nzExtra",N),t.xp6(3),t.Q6J("items",C.parameterslistData),t.xp6(2),t.Q6J("items",C.validatorsListData),t.xp6(2),t.Q6J("items",C.aggregatorsListData)}},dependencies:[b.Ls,A.t3,A.SK,v.Lr,v.Nx,v.iK,v.Fd,M.w,M.Zp,O.ix,E.w,Z.dQ,h,y._Y,y.Fj,y.JJ,y.JL,y.sg,y.u,f.Zv,f.yH,D.FY],styles:[".cdk-drag-preview{display:table}  .cdk-drag-placeholder{opacity:0}"]}),m})()},7090:(W,F,i)=>{i.r(F),i.d(F,{ProductModule:()=>Ct});var y=i(6895),s=i(1206),t=i(4575),e=i(8348),B=i(235),d=i(4650),b=i(7423),A=i(6616),v=i(7044),M=i(1664),O=i(1971),E=i(423);const Z=["componentChild"];function S(a,l){if(1&a){const o=d.EpF();d.TgZ(0,"button",4),d.NdJ("click",function(){d.CHM(o);const z=d.oxw();return d.KtG(z.handleCancel())}),d._uU(1," \u53d6\u6d88 "),d.qZA(),d.TgZ(2,"button",5),d.NdJ("click",function(){d.CHM(o);const z=d.oxw();return d.KtG(z.submit())}),d._UZ(3,"i",6),d._uU(4," \u4fdd\u5b58 "),d.qZA()}}let P=(()=>{class a{constructor(o,p){this.router=o,this.route=p,this.id=""}ngOnInit(){}submit(){this.componentChild.submit()}handleCancel(){const o=`${(0,B.kh)()}/product/list`;this.router.navigateByUrl(o)}}return a.\u0275fac=function(o){return new(o||a)(d.Y36(t.F0),d.Y36(t.gz))},a.\u0275cmp=d.Xpm({type:a,selectors:[["app-products-edit"]],viewQuery:function(o,p){if(1&o&&d.Gf(Z,5),2&o){let z;d.iGM(z=d.CRH())&&(p.componentChild=z.first)}},inputs:{id:"id"},decls:5,vars:3,consts:[["extra",""],[3,"nzTitle","nzExtra"],[3,"id"],["componentChild",""],["nz-button","",2,"margin-right","10px",3,"click"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","save","nzTheme","outline"]],template:function(o,p){if(1&o&&(d.YNc(0,S,5,0,"ng-template",null,0,d.W1O),d.TgZ(2,"nz-card",1),d._UZ(3,"app-product-edit-component",2,3),d.qZA()),2&o){const z=d.MAs(1);d.xp6(2),d.Q6J("nzTitle",p.id?"\u7f16\u8f91\u4ea7\u54c1":"\u521b\u5efa\u4ea7\u54c1")("nzExtra",z),d.xp6(1),d.Q6J("id",p.id)}},dependencies:[b.Ls,A.ix,v.w,M.dQ,O.bd,E.h],styles:[".cdk-drag-preview{display:table}  .cdk-drag-placeholder{opacity:0}"]}),a})();var k=i(1346);const I=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:e.P},{path:"edit/:id",component:P},{path:"create",component:P},{path:"**",component:k.r}];let R=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({imports:[t.Bz.forChild(I),t.Bz]}),a})();var $=i(8284),L=i(3325),K=i(6704),U=i(269),Q=i(2577),J=i(433),Y=i(7096),H=i(9166),g=i(5635),u=i(6903),c=i(9054),n=i(8e3),_=i(445);let G=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({}),a})();var j=i(3353),m=i(6287);let r=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({imports:[y.ez]}),a})();var C=i(1811),x=i(7570);let _t=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({imports:[_.vT,y.ez,b.PV,x.cg,g.o7,C.YI,r,G,m.T,j.ud]}),a})();var mt=i(6497),ht=i(3224),gt=i(6960),zt=i(1634);let Ct=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({imports:[y.ez,R,$.wm,L.ip,zt.uK,gt.Qp,b.PV,K.U5,g.o7,A.sL,mt._p,U.HQ,Q.S,H.Y,J.UX,Y.Zf,O.vh,u.zf,c.cD,n.LV,_t,s._t,ht.cS]}),a})()},8348:(W,F,i)=>{i.d(F,{P:()=>g});var y=i(5380),s=i(423),t=i(235),e=i(4650),B=i(6960),d=i(4575),b=i(1445),A=i(9651),v=i(6895),M=i(1634),O=i(3679),E=i(269),Z=i(5227),S=i(8989),P=i(7327),k=i(1918),I=i(558),R=i(5545);function $(u,c){if(1&u){const n=e.EpF();e.TgZ(0,"app-batch-btn",3),e.NdJ("add",function(){e.CHM(n);const h=e.oxw();return e.KtG(h.handleEdit())}),e.qZA()}2&u&&e.Q6J("showDelBtn",!1)}function L(u,c){if(1&u){const n=e.EpF();e.TgZ(0,"th",13),e.NdJ("nzCheckedChange",function(h){e.CHM(n);const f=e.oxw(2);return e.KtG(f.handleAllChecked(h))}),e.qZA()}if(2&u){const n=e.oxw(2);e.Q6J("nzChecked",n.checked)("nzIndeterminate",n.indeterminate)}}function K(u,c){if(1&u){const n=e.EpF();e.TgZ(0,"td",17),e.NdJ("nzCheckedChange",function(h){e.CHM(n);const f=e.oxw().$implicit,D=e.oxw(2);return e.KtG(D.handleItemChecked(f.id,h))}),e.qZA()}if(2&u){const n=e.oxw().$implicit,_=e.oxw(2);e.Q6J("nzChecked",_.setOfCheckedId.has(n.id))}}function U(u,c){if(1&u){const n=e.EpF();e.TgZ(0,"tr",14),e.NdJ("dblclick",function(){const f=e.CHM(n).$implicit,D=e.oxw(2);return e.KtG(D.select(f))}),e.YNc(1,K,1,1,"td",15),e.TgZ(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.ALo(10,"date"),e.qZA(),e.TgZ(11,"td")(12,"a",16),e.NdJ("click",function(){const f=e.CHM(n).$implicit,D=e.oxw(2);return e.KtG(D.select(f))}),e._uU(13," \u9009\u62e9 "),e.qZA()()()}if(2&u){const n=c.$implicit,_=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!_.ref),e.xp6(2),e.Oqu(n.id),e.xp6(2),e.Oqu(n.name),e.xp6(2),e.Oqu(n.desc),e.xp6(2),e.Oqu(e.lcZ(10,5,n.created))}}function Q(u,c){1&u&&e._uU(0),2&u&&e.hij("\u603b\u5171 ",c.$implicit," \u6761")}function J(u,c){if(1&u){const n=e.EpF();e.ynx(0),e.TgZ(1,"nz-table",4,5),e.NdJ("nzPageSizeChange",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.pageSizeChange(h))})("nzPageIndexChange",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.pageIndexChange(h))})("nzQueryParams",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.onQuery(h))}),e.TgZ(3,"thead")(4,"tr"),e.YNc(5,L,1,2,"th",6),e.TgZ(6,"th",7),e._uU(7,"ID"),e.qZA(),e.TgZ(8,"th",8),e._uU(9,"\u540d\u79f0"),e.qZA(),e.TgZ(10,"th",9),e._uU(11,"\u8bf4\u660e"),e.qZA(),e.TgZ(12,"th",10),e._uU(13,"\u65e5\u671f"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"\u64cd\u4f5c"),e.qZA()()(),e.TgZ(16,"tbody"),e.YNc(17,U,14,7,"tr",11),e.qZA()(),e.YNc(18,Q,1,1,"ng-template",null,12,e.W1O),e.BQk()}if(2&u){const n=e.MAs(2),_=e.MAs(19),h=e.oxw();e.xp6(1),e.Q6J("nzData",h.datum)("nzFrontPagination",!1)("nzLoading",h.loading)("nzScroll",h.getTableHeight())("nzShowTotal",_)("nzTotal",h.total)("nzPageSize",h.pageSize)("nzPageIndex",h.pageIndex),e.xp6(4),e.Q6J("ngIf",!h.ref),e.xp6(1),e.Q6J("nzSortFn",!0),e.xp6(2),e.Q6J("nzSortFn",!0),e.xp6(4),e.Q6J("nzSortFn",!0),e.xp6(5),e.Q6J("ngForOf",n.data)}}function Y(u,c){if(1&u){const n=e.EpF();e.TgZ(0,"div",22),e.NdJ("click",function(){const f=e.CHM(n).$implicit,D=e.oxw(2);return e.KtG(D.informate(f))}),e._UZ(1,"app-card",23),e.qZA()}if(2&u){const n=c.$implicit;e.xp6(1),e.Q6J("img","product.png")("id",n.id)("name",n.name)("title","\u4ea7\u54c1")}}function H(u,c){if(1&u){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",18),e.YNc(2,Y,2,4,"div",19),e.qZA(),e.TgZ(3,"app-detail",20),e.NdJ("edit",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.handleEdit(h))})("delete",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.delete(h))})("close",function(){e.CHM(n);const h=e.oxw();return e.KtG(h.close())}),e.qZA(),e.TgZ(4,"nz-pagination",21),e.NdJ("nzPageSizeChange",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.pageSizeCardChange(h))})("nzPageIndexChange",function(h){e.CHM(n);const f=e.oxw();return e.KtG(f.pageIndexCardChange(h))}),e.qZA(),e.BQk()}if(2&u){const n=e.oxw();e.xp6(1),e.Q6J("nzGutter",16),e.xp6(1),e.Q6J("ngForOf",n.datum),e.xp6(1),e.Q6J("isVisible",n.isVisible)("title","\u4ea7\u54c1")("chooseData",n.chooseData),e.xp6(1),e.Q6J("nzPageIndex",n.pageIndex)("nzTotal",n.total)("nzPageSize",n.pageSize)}}let g=(()=>{class u{constructor(n,_,h,f,D){this.modal=n,this.ref=_,this.router=h,this.rs=f,this.msg=D,this.isVisible=!1,this.chooseData={},this.loading=!1,this.datum=[],this.total=1,this.pageSize=20,this.pageIndex=1,this.query={},this.columnKeyNameArr=["name","desc"],this.uploading=!1,this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.delResData=[],this.pageSizeChange(this.pageSize)}reload(){this.datum=[],this.load()}informate(n){this.isVisible=!0,this.rs.get(`product/${n.id}`,this.query).subscribe(_=>{this.chooseData=_.data}).add(()=>{this.loading=!1})}load(){this.loading=!0,this.rs.post("product/search",this.query).subscribe(n=>{this.datum=n.data||[],this.total=n.total}).add(()=>{this.loading=!1})}create(){let n="/product/create";location.pathname.startsWith("/admin")&&(n="/admin"+n),this.router.navigateByUrl(n)}delete(n,_){this.rs.get(`product/${n}/delete`).subscribe(h=>{if(!_)return this.msg.success("\u5220\u9664\u6210\u529f"),this.datum=this.datum.filter(f=>f.id!==n),this.isVisible=!1,void this.load();this.delResData.push(h),_===this.delResData.length&&(this.msg.success("\u5220\u9664\u6210\u529f"),this.isVisible=!1,this.load(),this.delResData=[])})}close(){this.isVisible=!1}onQuery(n){(0,y.r)(n,this.query),this.load()}pageIndexChange(n){this.query.skip=n-1}pageSizeChange(n){this.query.limit=n}pageIndexCardChange(n){this.query.skip=(n-1)*this.pageSize,this.load()}pageSizeCardChange(n){this.query.limit=n,this.load()}search(n){this.query.keyword={name:n},this.query.skip=0,this.load()}edit(n){const _=`${(0,t.kh)()}/product/edit/${n}`;this.router.navigateByUrl(_)}handleNew(){const n=`${(0,t.kh)()}/product/create`;this.router.navigateByUrl(n)}handleEdit(n){this.isVisible=!1;const h=this.modal.create({nzTitle:n?"\u7f16\u8f91\u4ea7\u54c1":"\u521b\u5efa\u4ea7\u54c1",nzStyle:{top:"20px"},nzWidth:"80%",nzContent:s.h,nzComponentParams:{id:n},nzMaskClosable:!1,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>{h.destroy()}},{label:"\u4fdd\u5b58",type:"primary",onClick:f=>{f.submit().then(()=>{h.destroy(),this.load()},()=>{})}}]})}select(n){this.ref&&this.ref.close(n)}cancel(){this.msg.info("\u53d6\u6d88\u64cd\u4f5c")}getTableHeight(){return(0,t.NC)(this)}handleBatchDel(){(0,t.mK)(this)}handleAllChecked(n){(0,t.Yk)(n,this)}handleItemChecked(n,_){(0,t.mp)(n,_,this)}}return u.\u0275fac=function(n){return new(n||u)(e.Y36(B.Sf),e.Y36(B.Lf,8),e.Y36(d.F0),e.Y36(b.s),e.Y36(A.dD))},u.\u0275cmp=e.Xpm({type:u,selectors:[["app-products"]],decls:5,vars:3,consts:[["placeholder","\u8bf7\u8f93\u5165\u4ea7\u54c1\u540d\u79f0",3,"onSearch"],["uploadApi","/api/product/import","downloadApi","/api/product/export",3,"showDelBtn","add",4,"ngIf"],[4,"ngIf"],["uploadApi","/api/product/import","downloadApi","/api/product/export",3,"showDelBtn","add"],["nzShowPagination","","nzShowSizeChanger","",3,"nzData","nzFrontPagination","nzLoading","nzScroll","nzShowTotal","nzTotal","nzPageSize","nzPageIndex","nzPageSizeChange","nzPageIndexChange","nzQueryParams"],["basicTable",""],[3,"nzChecked","nzIndeterminate","nzCheckedChange",4,"ngIf"],["nzColumnKey","id",3,"nzSortFn"],["nzColumnKey","name",3,"nzSortFn"],["nzColumnKey","desc"],["nzColumnKey","created",3,"nzSortFn"],[3,"dblclick",4,"ngFor","ngForOf"],["totalTemplate",""],[3,"nzChecked","nzIndeterminate","nzCheckedChange"],[3,"dblclick"],[3,"nzChecked","nzCheckedChange",4,"ngIf"],[3,"click"],[3,"nzChecked","nzCheckedChange"],["nz-row","",1,"card",3,"nzGutter"],["nz-col","","class","card-item",3,"click",4,"ngFor","ngForOf"],[3,"isVisible","title","chooseData","edit","delete","close"],["nzShowSizeChanger","",2,"position","fixed","bottom","0","right","10px",3,"nzPageIndex","nzTotal","nzPageSize","nzPageSizeChange","nzPageIndexChange"],["nz-col","",1,"card-item",3,"click"],[3,"img","id","name","title"]],template:function(n,_){1&n&&(e.TgZ(0,"app-toolbar")(1,"app-search-form",0),e.NdJ("onSearch",function(f){return _.search(f)}),e.qZA(),e.YNc(2,$,1,1,"app-batch-btn",1),e.qZA(),e.YNc(3,J,20,13,"ng-container",2),e.YNc(4,H,5,8,"ng-container",2)),2&n&&(e.xp6(2),e.Q6J("ngIf",!_.ref),e.xp6(1),e.Q6J("ngIf",_.ref),e.xp6(1),e.Q6J("ngIf",!_.ref))},dependencies:[v.sg,v.O5,M.dE,O.t3,O.SK,E.N8,E.qD,E.Uo,E._C,E.h7,E.Om,E.p0,E.$Z,E.g6,Z.n,S.A,P.J,k.o,I.q,R.u],styles:[".card[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:10px 20px}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]{box-sizing:border-box;padding:5px}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),u})()},9054:(W,F,i)=>{i.d(F,{Zv:()=>Y,cD:()=>H,yH:()=>Q});var y=i(655),s=i(4650),t=i(4968),e=i(2722),B=i(9300),d=i(2539),b=i(2536),A=i(3303),v=i(3187),M=i(445),O=i(4903),E=i(6895),Z=i(7423),S=i(6287);const P=["*"],k=["collapseHeader"];function I(g,u){if(1&g&&(s.ynx(0),s._UZ(1,"span",7),s.BQk()),2&g){const c=u.$implicit,n=s.oxw(2);s.xp6(1),s.Q6J("nzType",c||"right")("nzRotate",n.nzActive?90:0)}}function R(g,u){if(1&g&&(s.TgZ(0,"div"),s.YNc(1,I,2,2,"ng-container",3),s.qZA()),2&g){const c=s.oxw();s.xp6(1),s.Q6J("nzStringTemplateOutlet",c.nzExpandedIcon)}}function $(g,u){if(1&g&&(s.ynx(0),s._uU(1),s.BQk()),2&g){const c=s.oxw();s.xp6(1),s.Oqu(c.nzHeader)}}function L(g,u){if(1&g&&(s.ynx(0),s._uU(1),s.BQk()),2&g){const c=s.oxw(2);s.xp6(1),s.Oqu(c.nzExtra)}}function K(g,u){if(1&g&&(s.TgZ(0,"div",8),s.YNc(1,L,2,1,"ng-container",3),s.qZA()),2&g){const c=s.oxw();s.xp6(1),s.Q6J("nzStringTemplateOutlet",c.nzExtra)}}const U="collapse";let Q=(()=>{class g{constructor(c,n,_,h){this.nzConfigService=c,this.cdr=n,this.directionality=_,this.destroy$=h,this._nzModuleName=U,this.nzAccordion=!1,this.nzBordered=!0,this.nzGhost=!1,this.nzExpandIconPosition="left",this.dir="ltr",this.listOfNzCollapsePanelComponent=[],this.nzConfigService.getConfigChangeEventForComponent(U).pipe((0,e.R)(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()})}ngOnInit(){this.directionality.change?.pipe((0,e.R)(this.destroy$)).subscribe(c=>{this.dir=c,this.cdr.detectChanges()}),this.dir=this.directionality.value}addPanel(c){this.listOfNzCollapsePanelComponent.push(c)}removePanel(c){this.listOfNzCollapsePanelComponent.splice(this.listOfNzCollapsePanelComponent.indexOf(c),1)}click(c){this.nzAccordion&&!c.nzActive&&this.listOfNzCollapsePanelComponent.filter(n=>n!==c).forEach(n=>{n.nzActive&&(n.nzActive=!1,n.nzActiveChange.emit(n.nzActive),n.markForCheck())}),c.nzActive=!c.nzActive,c.nzActiveChange.emit(c.nzActive)}}return g.\u0275fac=function(c){return new(c||g)(s.Y36(b.jY),s.Y36(s.sBO),s.Y36(M.Is,8),s.Y36(A.kn))},g.\u0275cmp=s.Xpm({type:g,selectors:[["nz-collapse"]],hostAttrs:[1,"ant-collapse"],hostVars:10,hostBindings:function(c,n){2&c&&s.ekj("ant-collapse-icon-position-left","left"===n.nzExpandIconPosition)("ant-collapse-icon-position-right","right"===n.nzExpandIconPosition)("ant-collapse-ghost",n.nzGhost)("ant-collapse-borderless",!n.nzBordered)("ant-collapse-rtl","rtl"===n.dir)},inputs:{nzAccordion:"nzAccordion",nzBordered:"nzBordered",nzGhost:"nzGhost",nzExpandIconPosition:"nzExpandIconPosition"},exportAs:["nzCollapse"],features:[s._Bn([A.kn])],ngContentSelectors:P,decls:1,vars:0,template:function(c,n){1&c&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),(0,y.gn)([(0,b.oS)(),(0,v.yF)()],g.prototype,"nzAccordion",void 0),(0,y.gn)([(0,b.oS)(),(0,v.yF)()],g.prototype,"nzBordered",void 0),(0,y.gn)([(0,b.oS)(),(0,v.yF)()],g.prototype,"nzGhost",void 0),g})();const J="collapsePanel";let Y=(()=>{class g{constructor(c,n,_,h,f,D){this.nzConfigService=c,this.ngZone=n,this.cdr=_,this.destroy$=h,this.nzCollapseComponent=f,this.noAnimation=D,this._nzModuleName=J,this.nzActive=!1,this.nzDisabled=!1,this.nzShowArrow=!0,this.nzActiveChange=new s.vpe,this.nzConfigService.getConfigChangeEventForComponent(J).pipe((0,e.R)(this.destroy$)).subscribe(()=>{this.cdr.markForCheck()})}markForCheck(){this.cdr.markForCheck()}ngOnInit(){this.nzCollapseComponent.addPanel(this),this.ngZone.runOutsideAngular(()=>(0,t.R)(this.collapseHeader.nativeElement,"click").pipe((0,B.h)(()=>!this.nzDisabled),(0,e.R)(this.destroy$)).subscribe(()=>{this.ngZone.run(()=>{this.nzCollapseComponent.click(this),this.cdr.markForCheck()})}))}ngOnDestroy(){this.nzCollapseComponent.removePanel(this)}}return g.\u0275fac=function(c){return new(c||g)(s.Y36(b.jY),s.Y36(s.R0b),s.Y36(s.sBO),s.Y36(A.kn),s.Y36(Q,1),s.Y36(O.P,8))},g.\u0275cmp=s.Xpm({type:g,selectors:[["nz-collapse-panel"]],viewQuery:function(c,n){if(1&c&&s.Gf(k,7),2&c){let _;s.iGM(_=s.CRH())&&(n.collapseHeader=_.first)}},hostAttrs:[1,"ant-collapse-item"],hostVars:6,hostBindings:function(c,n){2&c&&s.ekj("ant-collapse-no-arrow",!n.nzShowArrow)("ant-collapse-item-active",n.nzActive)("ant-collapse-item-disabled",n.nzDisabled)},inputs:{nzActive:"nzActive",nzDisabled:"nzDisabled",nzShowArrow:"nzShowArrow",nzExtra:"nzExtra",nzHeader:"nzHeader",nzExpandedIcon:"nzExpandedIcon"},outputs:{nzActiveChange:"nzActiveChange"},exportAs:["nzCollapsePanel"],features:[s._Bn([A.kn])],ngContentSelectors:P,decls:8,vars:8,consts:[["role","button",1,"ant-collapse-header"],["collapseHeader",""],[4,"ngIf"],[4,"nzStringTemplateOutlet"],["class","ant-collapse-extra",4,"ngIf"],[1,"ant-collapse-content"],[1,"ant-collapse-content-box"],["nz-icon","",1,"ant-collapse-arrow",3,"nzType","nzRotate"],[1,"ant-collapse-extra"]],template:function(c,n){1&c&&(s.F$t(),s.TgZ(0,"div",0,1),s.YNc(2,R,2,1,"div",2),s.YNc(3,$,2,1,"ng-container",3),s.YNc(4,K,2,1,"div",4),s.qZA(),s.TgZ(5,"div",5)(6,"div",6),s.Hsn(7),s.qZA()()),2&c&&(s.uIk("aria-expanded",n.nzActive),s.xp6(2),s.Q6J("ngIf",n.nzShowArrow),s.xp6(1),s.Q6J("nzStringTemplateOutlet",n.nzHeader),s.xp6(1),s.Q6J("ngIf",n.nzExtra),s.xp6(1),s.ekj("ant-collapse-content-active",n.nzActive),s.Q6J("@.disabled",!(null==n.noAnimation||!n.noAnimation.nzNoAnimation))("@collapseMotion",n.nzActive?"expanded":"hidden"))},dependencies:[E.O5,Z.Ls,S.f],encapsulation:2,data:{animation:[d.J_]},changeDetection:0}),(0,y.gn)([(0,v.yF)()],g.prototype,"nzActive",void 0),(0,y.gn)([(0,v.yF)()],g.prototype,"nzDisabled",void 0),(0,y.gn)([(0,b.oS)(),(0,v.yF)()],g.prototype,"nzShowArrow",void 0),g})(),H=(()=>{class g{}return g.\u0275fac=function(c){return new(c||g)},g.\u0275mod=s.oAB({type:g}),g.\u0275inj=s.cJS({imports:[M.vT,E.ez,Z.PV,S.T,O.g]}),g})()}}]);