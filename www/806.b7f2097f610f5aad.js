"use strict";(self.webpackChunkiot_master_ui=self.webpackChunkiot_master_ui||[]).push([[806],{3806:(G,g,r)=>{r.r(g),r.d(g,{BrokerModule:()=>$});var h=r(6895),k=r(8284),Z=r(3325),T=r(7423),d=r(6704),z=r(5635),b=r(6616),y=r(269),x=r(2577),J=r(9166),l=r(433),f=r(7096),F=r(1971),A=r(6903),c=r(4575),E=r(5380),m=r(235),t=r(4650),C=r(1445),v=r(9651),p=r(3679);function Q(e,s){1&e&&(t.ynx(0),t._uU(1,"\u8bf7\u8f93\u5165\u540d\u79f0!"),t.BQk())}function D(e,s){1&e&&t.YNc(0,Q,2,0,"ng-container",14),2&e&&t.Q6J("ngIf",s.$implicit.hasError("required"))}let u=(()=>{class e{constructor(n,o,i){this.fb=n,this.rs=o,this.msg=i,this.id=""}ngOnInit(){this.id&&this.rs.get(`broker/${this.id}`).subscribe(n=>{this.build(n.data)}),this.build()}build(n){this.group=this.fb.group({id:[(n=n||{}).id||"",[]],name:[n.name||"",[l.kI.required]],desc:[n.desc||"",[]],port:[n.port||1883,[]],cert:[n.cert||"",[]],key:[n.key||"",[]]})}submit(){return new Promise((n,o)=>{this.group.valid?this.rs.post(this.id?`broker/${this.id}`:"broker/create",this.group.value).subscribe(a=>{this.msg.success("\u4fdd\u5b58\u6210\u529f"),n(!0)}):Object.values(this.group.controls).forEach(i=>{i.invalid&&(i.markAsDirty(),i.updateValueAndValidity({onlySelf:!0}),o())})})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(l.qu),t.Y36(C.s),t.Y36(v.dD))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-brokers-edit"]],inputs:{id:"id"},decls:28,vars:24,consts:[["nz-form","",3,"formGroup","ngSubmit"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","name"],["nameErrorTpl",""],["nzFor","desc",3,"nzSm","nzXs"],["nzErrorTip","",3,"nzSm","nzXs"],["nz-input","","formControlName","desc"],["nzFor","port",3,"nzSm","nzXs"],["formControlName","port",3,"nzMax","nzMin"],["nzFor","cert",3,"nzSm","nzXs"],["nz-input","","formControlName","cert"],["nzFor","key",3,"nzSm","nzXs"],["nz-input","","formControlName","key"],[4,"ngIf"]],template:function(n,o){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return o.submit()}),t.TgZ(1,"nz-form-item")(2,"nz-form-label",1),t._uU(3,"\u540d\u79f0"),t.qZA(),t.TgZ(4,"nz-form-control",2),t._UZ(5,"input",3),t.YNc(6,D,1,1,"ng-template",null,4,t.W1O),t.qZA()(),t.TgZ(8,"nz-form-item")(9,"nz-form-label",5),t._uU(10,"\u8bf4\u660e"),t.qZA(),t.TgZ(11,"nz-form-control",6),t._UZ(12,"textarea",7),t.qZA()(),t.TgZ(13,"nz-form-item")(14,"nz-form-label",8),t._uU(15,"\u7aef\u53e3"),t.qZA(),t.TgZ(16,"nz-form-control",6),t._UZ(17,"nz-input-number",9),t.qZA()(),t.TgZ(18,"nz-form-item")(19,"nz-form-label",10),t._uU(20,"cert"),t.qZA(),t.TgZ(21,"nz-form-control",2),t._UZ(22,"input",11),t.qZA()(),t.TgZ(23,"nz-form-item")(24,"nz-form-label",12),t._uU(25,"key"),t.qZA(),t.TgZ(26,"nz-form-control",2),t._UZ(27,"input",13),t.qZA()()()),2&n){const i=t.MAs(7);t.Q6J("formGroup",o.group),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",i),t.xp6(5),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMax",65535)("nzMin",100),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24)}},dependencies:[h.O5,p.t3,p.SK,d.Lr,d.Nx,d.iK,d.Fd,z.Zp,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,f._V]}),e})();var B=r(6960),S=r(1634),X=r(5227),M=r(8989),P=r(7327),N=r(1918),U=r(558);function _(e,s){if(1&e){const n=t.EpF();t.TgZ(0,"div",6),t.NdJ("click",function(){const a=t.CHM(n).$implicit,K=t.oxw();return t.KtG(K.informate(a))}),t._UZ(1,"app-card",7),t.qZA()}if(2&e){const n=s.$implicit;t.xp6(1),t.Q6J("img","server.png")("id",n.id)("name",n.name)("title","\u603b\u7ebf")}}let I=(()=>{class e{constructor(n,o,i,a){this.modal=n,this.router=o,this.rs=i,this.msg=a,this.uploading=!1,this.loading=!0,this.isVisible=!1,this.datum=[],this.total=1,this.pageSize=20,this.pageIndex=1,this.query={},this.chooseData={},this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.delResData=[],this.pageSizeChange(this.pageSize)}reload(){this.datum=[],this.load()}load(){this.loading=!0,this.rs.post("broker/search",this.query).subscribe(n=>{this.datum=n.data||[],this.total=n.total}).add(()=>{this.loading=!1})}close(){this.isVisible=!1}informate(n){this.isVisible=!0,this.rs.get(`broker/${n.id}`,this.query).subscribe(o=>{this.chooseData=o.data}).add(()=>{this.loading=!1})}create(){let n="/broker/create";location.pathname.startsWith("/admin")&&(n="/admin"+n),this.router.navigateByUrl(n)}delete(n,o){this.rs.get(`broker/${n}/delete`).subscribe(i=>{o?o&&(this.delResData.push(i),o===this.delResData.length&&(this.msg.success("\u5220\u9664\u6210\u529f"),this.load())):(this.msg.success("\u5220\u9664\u6210\u529f"),this.datum=this.datum.filter(a=>a.id!==n),this.load())})}handleExport(){this.href="/api/broker/export"}onQuery(n){(0,E.r)(n,this.query),this.load()}pageIndexChange(n){this.query.skip=n-1,this.load()}pageSizeChange(n){this.query.limit=n,this.load()}search(n){this.query.keyword={name:n},this.query.skip=0,this.load()}handleEdit(n){this.isVisible=!1;const i=this.modal.create({nzTitle:n?"\u7f16\u8f91\u603b\u7ebf":"\u521b\u5efa\u603b\u7ebf",nzStyle:{top:"20px"},nzContent:u,nzComponentParams:{id:n},nzMaskClosable:!1,nzFooter:[{label:"\u53d6\u6d88",onClick:()=>{i.destroy()}},{label:"\u4fdd\u5b58",type:"primary",onClick:a=>{a.submit().then(()=>{i.destroy(),this.load()},()=>{})}}]})}cancel(){this.msg.info("\u53d6\u6d88\u64cd\u4f5c")}getTableHeight(){return(0,m.NC)(this)}handleBatchDel(){(0,m.mK)(this)}handleAllChecked(n){(0,m.Yk)(n,this)}handleItemChecked(n,o){(0,m.mp)(n,o,this)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(B.Sf),t.Y36(c.F0),t.Y36(C.s),t.Y36(v.dD))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-brokers"]],decls:7,vars:9,consts:[["placeholder","\u8bf7\u8f93\u5165\u540d\u79f0",3,"onSearch"],["uploadApi","/api/broker/import","downloadApi","/api/broker/export",3,"showDelBtn","add"],["nz-row","",1,"card",3,"nzGutter"],["nz-col","","class","card-item",3,"click",4,"ngFor","ngForOf"],[3,"isVisible","title","chooseData","edit","delete","close"],["nzShowSizeChanger","",2,"position","fixed","bottom","0","right","10px",3,"nzPageIndex","nzTotal","nzPageSize","nzPageSizeChange","nzPageIndexChange"],["nz-col","",1,"card-item",3,"click"],[3,"img","id","name","title"]],template:function(n,o){1&n&&(t.TgZ(0,"app-toolbar")(1,"app-search-form",0),t.NdJ("onSearch",function(a){return o.search(a)}),t.qZA(),t.TgZ(2,"app-batch-btn",1),t.NdJ("add",function(){return o.handleEdit()}),t.qZA()(),t.TgZ(3,"div",2),t.YNc(4,_,2,4,"div",3),t.qZA(),t.TgZ(5,"app-detail",4),t.NdJ("edit",function(a){return o.handleEdit(a)})("delete",function(a){return o.delete(a)})("close",function(){return o.close()}),t.qZA(),t.TgZ(6,"nz-pagination",5),t.NdJ("nzPageSizeChange",function(a){return o.pageSizeChange(a)})("nzPageIndexChange",function(a){return o.pageIndexChange(a)}),t.qZA()),2&n&&(t.xp6(2),t.Q6J("showDelBtn",!1),t.xp6(1),t.Q6J("nzGutter",16),t.xp6(1),t.Q6J("ngForOf",o.datum),t.xp6(1),t.Q6J("isVisible",o.isVisible)("title","\u603b\u7ebf")("chooseData",o.chooseData),t.xp6(1),t.Q6J("nzPageIndex",o.pageIndex)("nzTotal",o.total)("nzPageSize",o.pageSize))},dependencies:[h.sg,p.t3,p.SK,S.dE,X.n,M.A,P.J,N.o,U.q],styles:[".card[_ngcontent-%COMP%]{box-sizing:border-box;padding:10px 20px;width:100%}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]{box-sizing:border-box;padding:5px}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),e})();var Y=r(1346);const O=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:I},{path:"detail/:id",component:(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-broker-detail"]],decls:2,vars:0,template:function(n,o){1&n&&(t.TgZ(0,"p"),t._uU(1,"broker-detail works!"),t.qZA())}}),e})()},{path:"edit/:id",component:u},{path:"create",component:u},{path:"**",component:Y.r}];let V=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[c.Bz.forChild(O),c.Bz]}),e})();var R=r(6497);let $=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[h.ez,V,k.wm,Z.ip,T.PV,R._p,d.U5,B.Qp,S.uK,z.o7,b.sL,y.HQ,x.S,J.Y,l.UX,f.Zf,F.vh,A.zf]}),e})()}}]);