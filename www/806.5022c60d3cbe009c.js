"use strict";(self.webpackChunkiot_master_ui=self.webpackChunkiot_master_ui||[]).push([[806],{3806:(tt,g,r)=>{r.r(g),r.d(g,{BrokerModule:()=>j});var d=r(6895),Z=r(8284),S=r(3325),f=r(7423),p=r(6704),C=r(5635),_=r(6616),v=r(269),y=r(2577),F=r(9166),l=r(433),x=r(7096),J=r(1971),u=r(6903),h=r(4575),E=r(5380),m=r(235),t=r(4650),T=r(1445),B=r(9651),c=r(3679);function A(e,a){1&e&&(t.ynx(0),t._uU(1,"\u8bf7\u8f93\u5165\u540d\u79f0!"),t.BQk())}function M(e,a){1&e&&t.YNc(0,A,2,0,"ng-container",14),2&e&&t.Q6J("ngIf",a.$implicit.hasError("required"))}let z=(()=>{class e{constructor(n,o,i){this.fb=n,this.rs=o,this.msg=i,this.id=""}ngOnInit(){this.id&&this.rs.get(`broker/${this.id}`).subscribe(n=>{this.build(n.data)}),this.build()}build(n){this.group=this.fb.group({id:[(n=n||{}).id||"",[]],name:[n.name||"",[l.kI.required]],desc:[n.desc||"",[]],port:[n.port||1883,[]],cert:[n.cert||"",[]],key:[n.key||"",[]]})}submit(){return new Promise((n,o)=>{this.group.valid?this.rs.post(this.id?`broker/${this.id}`:"broker/create",this.group.value).subscribe(s=>{this.msg.success("\u4fdd\u5b58\u6210\u529f"),n(!0)}):Object.values(this.group.controls).forEach(i=>{i.invalid&&(i.markAsDirty(),i.updateValueAndValidity({onlySelf:!0}),o())})})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(l.qu),t.Y36(T.s),t.Y36(B.dD))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-brokers-edit"]],inputs:{id:"id"},decls:28,vars:24,consts:[["nz-form","",3,"formGroup","ngSubmit"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","name"],["nameErrorTpl",""],["nzFor","desc",3,"nzSm","nzXs"],["nzErrorTip","",3,"nzSm","nzXs"],["nz-input","","formControlName","desc"],["nzFor","port",3,"nzSm","nzXs"],["formControlName","port",3,"nzMax","nzMin"],["nzFor","cert",3,"nzSm","nzXs"],["nz-input","","formControlName","cert"],["nzFor","key",3,"nzSm","nzXs"],["nz-input","","formControlName","key"],[4,"ngIf"]],template:function(n,o){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return o.submit()}),t.TgZ(1,"nz-form-item")(2,"nz-form-label",1),t._uU(3,"\u540d\u79f0"),t.qZA(),t.TgZ(4,"nz-form-control",2),t._UZ(5,"input",3),t.YNc(6,M,1,1,"ng-template",null,4,t.W1O),t.qZA()(),t.TgZ(8,"nz-form-item")(9,"nz-form-label",5),t._uU(10,"\u8bf4\u660e"),t.qZA(),t.TgZ(11,"nz-form-control",6),t._UZ(12,"textarea",7),t.qZA()(),t.TgZ(13,"nz-form-item")(14,"nz-form-label",8),t._uU(15,"\u7aef\u53e3"),t.qZA(),t.TgZ(16,"nz-form-control",6),t._UZ(17,"nz-input-number",9),t.qZA()(),t.TgZ(18,"nz-form-item")(19,"nz-form-label",10),t._uU(20,"cert"),t.qZA(),t.TgZ(21,"nz-form-control",2),t._UZ(22,"input",11),t.qZA()(),t.TgZ(23,"nz-form-item")(24,"nz-form-label",12),t._uU(25,"key"),t.qZA(),t.TgZ(26,"nz-form-control",2),t._UZ(27,"input",13),t.qZA()()()),2&n){const i=t.MAs(7);t.Q6J("formGroup",o.group),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",i),t.xp6(5),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMax",65535)("nzMin",100),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24)}},dependencies:[d.O5,c.t3,c.SK,p.Lr,p.Nx,p.iK,p.Fd,C.Zp,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,x._V]}),e})();var b=r(6960),k=r(1634),Q=r(7044),N=r(1664),U=r(5227),D=r(297),P=r(2451),X=r(8989),I=r(7327);function Y(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.reload())}),t._UZ(1,"i",9),t._uU(2," \u5237\u65b0 "),t.qZA()}if(2&e){const n=t.oxw();t.xp6(1),t.Q6J("nzSpin",n.loading)}}function O(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"app-search-box",10),t.NdJ("onSearch",function(i){t.CHM(n);const s=t.oxw();return t.KtG(s.search(i))}),t.qZA()}}function V(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.handleEdit())}),t._UZ(1,"i",11),t._uU(2," \u521b\u5efa\u603b\u7ebf "),t.qZA()}}function K(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",12),t._UZ(1,"span",13),t.TgZ(2,"a",14),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.handleExport())}),t._uU(3,"\u5bfc\u51fa"),t.qZA()()}if(2&e){const n=t.oxw();t.xp6(2),t.Q6J("href",n.href,t.LSH)}}function G(e,a){1&e&&t._UZ(0,"app-import",15),2&e&&t.Q6J("url","broker/import")}function H(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div",16),t.NdJ("click",function(){const s=t.CHM(n).$implicit,w=t.oxw();return t.KtG(w.informate(s))}),t._UZ(1,"app-card",17),t.qZA()}if(2&e){const n=a.$implicit;t.xp6(1),t.Q6J("img","server.png")("id",n.id)("name",n.name)("title","\u603b\u7ebf")}}let $=(()=>{class e{constructor(n,o,i,s){this.modal=n,this.router=o,this.rs=i,this.msg=s,this.uploading=!1,this.loading=!0,this.isVisible=!1,this.datum=[],this.total=1,this.pageSize=20,this.pageIndex=1,this.query={},this.chooseData={},this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.delResData=[],this.pageSizeChange(this.pageSize)}reload(){this.datum=[],this.load()}load(){this.loading=!0,this.rs.post("broker/search",this.query).subscribe(n=>{this.datum=n.data||[],this.total=n.total}).add(()=>{this.loading=!1})}close(){this.isVisible=!1}informate(n){this.isVisible=!0,this.rs.get(`broker/${n.id}`,this.query).subscribe(o=>{this.chooseData=o.data}).add(()=>{this.loading=!1})}create(){let n="/broker/create";location.pathname.startsWith("/admin")&&(n="/admin"+n),this.router.navigateByUrl(n)}delete(n,o){this.rs.get(`broker/${n}/delete`).subscribe(i=>{o?o&&(this.delResData.push(i),o===this.delResData.length&&(this.msg.success("\u5220\u9664\u6210\u529f"),this.load())):(this.msg.success("\u5220\u9664\u6210\u529f"),this.datum=this.datum.filter(s=>s.id!==n),this.load())})}handleExport(){this.href="/api/broker/export"}onQuery(n){(0,E.r)(n,this.query),this.load()}pageIndexChange(n){this.query.skip=n-1,this.load()}pageSizeChange(n){this.query.limit=n,this.load()}search(n){this.query.keyword={name:n},this.query.skip=0,this.load()}handleEdit(n){this.isVisible=!1;const i=this.modal.create({nzTitle:n?"\u7f16\u8f91\u603b\u7ebf":"\u521b\u5efa\u603b\u7ebf",nzStyle:{top:"20px"},nzContent:z,nzComponentParams:{id:n},nzFooter:[{label:"\u53d6\u6d88",onClick:()=>{i.destroy()}},{label:"\u4fdd\u5b58",type:"primary",onClick:s=>{s.submit().then(()=>{i.destroy(),this.load()},()=>{})}}]})}cancel(){this.msg.info("\u53d6\u6d88\u64cd\u4f5c")}getTableHeight(){return(0,m.NC)(this)}handleBatchDel(){(0,m.mK)(this)}handleAllChecked(n){(0,m.Yk)(n,this)}handleItemChecked(n,o){(0,m.mp)(n,o,this)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(b.Sf),t.Y36(h.F0),t.Y36(T.s),t.Y36(B.dD))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-brokers"]],decls:11,vars:8,consts:[["nz-button","","nzType","primary",3,"click",4,"nzSpaceItem"],["placeholder","\u8bf7\u8f93\u5165\u540d\u79f0",3,"onSearch",4,"nzSpaceItem"],["nz-button","","nzType","primary","class","btn",4,"nzSpaceItem"],[3,"url",4,"nzSpaceItem"],["nz-row","",1,"card",3,"nzGutter"],["nz-col","","class","card-item",3,"click",4,"ngFor","ngForOf"],[3,"isVisible","title","chooseData","edit","delete","close"],["nzShowSizeChanger","",2,"position","fixed","bottom","0","right","10px",3,"nzPageIndex","nzTotal","nzPageSize","nzPageSizeChange","nzPageIndexChange"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","reload",3,"nzSpin"],["placeholder","\u8bf7\u8f93\u5165\u540d\u79f0",3,"onSearch"],["nz-icon","","nzType","plus"],["nz-button","","nzType","primary",1,"btn"],["nz-icon","","nzType","cloud-download","nzTheme","outline"],["download","filename",3,"href","click"],[3,"url"],["nz-col","",1,"card-item",3,"click"],[3,"img","id","name","title"]],template:function(n,o){1&n&&(t.TgZ(0,"app-toolbar")(1,"nz-space"),t.YNc(2,Y,3,1,"button",0),t.YNc(3,O,1,0,"app-search-box",1),t.YNc(4,V,3,0,"button",0),t.YNc(5,K,4,1,"button",2),t.YNc(6,G,1,1,"app-import",3),t.qZA()(),t.TgZ(7,"div",4),t.YNc(8,H,2,4,"div",5),t.qZA(),t.TgZ(9,"app-detail",6),t.NdJ("edit",function(s){return o.handleEdit(s)})("delete",function(s){return o.delete(s)})("close",function(){return o.close()}),t.qZA(),t.TgZ(10,"nz-pagination",7),t.NdJ("nzPageSizeChange",function(s){return o.pageSizeChange(s)})("nzPageIndexChange",function(s){return o.pageIndexChange(s)}),t.qZA()),2&n&&(t.xp6(7),t.Q6J("nzGutter",16),t.xp6(1),t.Q6J("ngForOf",o.datum),t.xp6(1),t.Q6J("isVisible",o.isVisible)("title","\u603b\u7ebf")("chooseData",o.chooseData),t.xp6(1),t.Q6J("nzPageIndex",o.pageIndex)("nzTotal",o.total)("nzPageSize",o.pageSize))},dependencies:[d.sg,f.Ls,c.t3,c.SK,k.dE,_.ix,Q.w,N.dQ,U.n,D.B,P.k,X.A,I.J,u.NU,u.$1],styles:[".btn[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:82px;height:32px;border-radius:3px}.btn[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;margin-left:5px;font-size:14px}.card[_ngcontent-%COMP%]{box-sizing:border-box;padding:10px 20px;width:100%}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]{box-sizing:border-box;padding:5px}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),e})();var R=r(1346);const L=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:$},{path:"detail/:id",component:(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-broker-detail"]],decls:2,vars:0,template:function(n,o){1&n&&(t.TgZ(0,"p"),t._uU(1,"broker-detail works!"),t.qZA())}}),e})()},{path:"edit/:id",component:z},{path:"create",component:z},{path:"**",component:R.r}];let W=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[h.Bz.forChild(L),h.Bz]}),e})();var q=r(6497);let j=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[d.ez,W,Z.wm,S.ip,f.PV,q._p,p.U5,b.Qp,k.uK,C.o7,_.sL,v.HQ,y.S,F.Y,l.UX,x.Zf,J.vh,u.zf]}),e})()}}]);