"use strict";(self.webpackChunkiot_master_ui=self.webpackChunkiot_master_ui||[]).push([[518],{7518:(cn,f,i)=>{i.r(f),i.d(f,{PluginModule:()=>pn});var m=i(6895),c=i(4575),y=i(5380),l=i(433),n=i(4650),_=i(1445),C=i(9651),p=i(3679),u=i(6704),x=i(5635),T=i(1243),Z=i(8213);function E(e,a){1&e&&(n.ynx(0),n._uU(1,"\u8bf7\u8f93\u5165ID!"),n.BQk())}function F(e,a){1&e&&n.YNc(0,E,2,0,"ng-container",23),2&e&&n.Q6J("ngIf",a.$implicit.hasError("required"))}function J(e,a){1&e&&(n.ynx(0),n._uU(1,"\u8bf7\u8f93\u5165\u540d\u79f0!"),n.BQk())}function A(e,a){1&e&&n.YNc(0,J,2,0,"ng-container",23),2&e&&n.Q6J("ngIf",a.$implicit.hasError("required"))}function Q(e,a){1&e&&(n.ynx(0),n._uU(1,"\u8bf7\u8f93\u5165\u7248\u672c!"),n.BQk())}function U(e,a){1&e&&n.YNc(0,Q,2,0,"ng-container",23),2&e&&n.Q6J("ngIf",a.$implicit.hasError("required"))}function N(e,a){1&e&&(n.ynx(0),n._uU(1,"\u8bf7\u8f93\u5165\u547d\u4ee4!"),n.BQk())}function X(e,a){1&e&&n.YNc(0,N,2,0,"ng-container",23),2&e&&n.Q6J("ngIf",a.$implicit.hasError("required"))}let d=(()=>{class e{constructor(t,o,r){this.fb=t,this.rs=o,this.msg=r,this.id=""}ngOnInit(){this.id&&this.rs.get(`plugin/${this.id}`).subscribe(t=>{this.build(t.data)}),this.build()}build(t){this.group=this.fb.group({id:[(t=t||{}).id||"",[]],name:[t.name||"",[l.kI.required]],version:[t.version||"",[]],username:[t.username||"",[]],password:[t.password||"",[]],external:[t.external||!1,[]],command:[t.command||"",[]],dependencies:[t.dependencies||{},[]],disabled:[t.disabled||!1,[]]})}submit(){return new Promise((t,o)=>{this.group.valid?this.rs.post(this.id?`plugin/${this.id}`:"plugin/create",this.group.value).subscribe(s=>{this.msg.success("\u4fdd\u5b58\u6210\u529f"),t(!0)}):Object.values(this.group.controls).forEach(r=>{r.invalid&&(r.markAsDirty(),r.updateValueAndValidity({onlySelf:!0}),o())})})}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(l.qu),n.Y36(_.s),n.Y36(C.dD))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-plugin-edit"]],inputs:{id:"id"},decls:50,vars:37,consts:[["nz-form","",3,"formGroup","ngSubmit"],["nzFor","id",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","id"],["IDErrorTpl",""],["nzFor","name","nzRequired","",3,"nzSm","nzXs"],["nz-input","","formControlName","name"],["nameErrorTpl",""],["nzFor","username",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nz-input","","formControlName","username"],["nzFor","password",3,"nzSm","nzXs"],["nz-input","","type","password","formControlName","password"],["nzFor","external",3,"nzSm","nzXs"],["nz-checkbox","","formControlName","external"],["nzFor","version",3,"nzSm","nzXs"],["nz-input","","formControlName","version"],["verErrorTpl",""],["nzFor","command",3,"nzSm","nzXs"],["nz-input","","formControlName","command"],["comErrorTpl",""],["nzFor","disabled",3,"nzSm","nzXs"],["nzCheckedChildren","\u662f","nzUnCheckedChildren","\u5426","name","disabled","formControlName","disabled"],[4,"ngIf"]],template:function(t,o){if(1&t&&(n.TgZ(0,"form",0),n.NdJ("ngSubmit",function(){return o.submit()}),n.TgZ(1,"nz-form-item")(2,"nz-form-label",1),n._uU(3,"ID"),n.qZA(),n.TgZ(4,"nz-form-control",2),n._UZ(5,"input",3),n.YNc(6,F,1,1,"ng-template",null,4,n.W1O),n.qZA()(),n.TgZ(8,"nz-form-item")(9,"nz-form-label",5),n._uU(10,"\u540d\u79f0"),n.qZA(),n.TgZ(11,"nz-form-control",2),n._UZ(12,"input",6),n.YNc(13,A,1,1,"ng-template",null,7,n.W1O),n.qZA()(),n.TgZ(15,"nz-form-item")(16,"nz-form-label",8),n._uU(17,"\u7528\u6237\u540d"),n.qZA(),n.TgZ(18,"nz-form-control",9),n._UZ(19,"input",10),n.qZA()(),n.TgZ(20,"nz-form-item")(21,"nz-form-label",11),n._uU(22,"\u5bc6\u7801"),n.qZA(),n.TgZ(23,"nz-form-control",9),n._UZ(24,"input",12),n.qZA()(),n.TgZ(25,"nz-form-item")(26,"nz-form-label",13),n._uU(27,"\u5916\u90e8"),n.qZA(),n.TgZ(28,"nz-form-control",9)(29,"label",14),n._uU(30,"\u5916\u90e8"),n.qZA()()(),n.TgZ(31,"nz-form-item")(32,"nz-form-label",15),n._uU(33,"\u7248\u672c"),n.qZA(),n.TgZ(34,"nz-form-control",2),n._UZ(35,"input",16),n.YNc(36,U,1,1,"ng-template",null,17,n.W1O),n.qZA()(),n.TgZ(38,"nz-form-item")(39,"nz-form-label",18),n._uU(40,"\u547d\u4ee4"),n.qZA(),n.TgZ(41,"nz-form-control",2),n._UZ(42,"input",19),n.YNc(43,X,1,1,"ng-template",null,20,n.W1O),n.qZA()(),n.TgZ(45,"nz-form-item")(46,"nz-form-label",21),n._uU(47,"\u662f\u5426\u7981\u7528"),n.qZA(),n.TgZ(48,"nz-form-control",9),n._UZ(49,"nz-switch",22),n.qZA()()()),2&t){const r=n.MAs(7),s=n.MAs(14),h=n.MAs(37),mn=n.MAs(44);n.Q6J("formGroup",o.group),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",r),n.xp6(5),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",s),n.xp6(5),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(4),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",h),n.xp6(5),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)("nzErrorTip",mn),n.xp6(5),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24)}},dependencies:[m.O5,p.t3,p.SK,u.Lr,u.Nx,u.iK,u.Fd,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,x.Zp,T.i,Z.Ie]}),e})();var g=i(235),P=i(6960),b=i(7423),S=i(1634),v=i(6616),D=i(7044),I=i(1664),M=i(5227),Y=i(297),B=i(2451),O=i(8989),$=i(7327),z=i(6903);function K(e,a){if(1&e){const t=n.EpF();n.TgZ(0,"button",8),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.reload())}),n._UZ(1,"i",9),n._uU(2," \u5237\u65b0 "),n.qZA()}if(2&e){const t=n.oxw();n.xp6(1),n.Q6J("nzSpin",t.loading)}}function V(e,a){if(1&e){const t=n.EpF();n.TgZ(0,"app-search-box",10),n.NdJ("onSearch",function(r){n.CHM(t);const s=n.oxw();return n.KtG(s.search(r))}),n.qZA()}}function G(e,a){if(1&e){const t=n.EpF();n.TgZ(0,"button",8),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.handleEdit())}),n._UZ(1,"i",11),n._uU(2," \u521b\u5efa\u63d2\u4ef6 "),n.qZA()}}function H(e,a){if(1&e){const t=n.EpF();n.TgZ(0,"button",12),n._UZ(1,"span",13),n.TgZ(2,"a",14),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.handleExport())}),n._uU(3,"\u5bfc\u51fa"),n.qZA()()}if(2&e){const t=n.oxw();n.xp6(2),n.Q6J("href",t.href,n.LSH)}}function R(e,a){1&e&&n._UZ(0,"app-import",15),2&e&&n.Q6J("url","plugin/import")}function k(e,a){if(1&e){const t=n.EpF();n.TgZ(0,"div",16),n.NdJ("click",function(){const s=n.CHM(t).$implicit,h=n.oxw();return n.KtG(h.informate(s))}),n._UZ(1,"app-card",17),n.qZA()}if(2&e){const t=a.$implicit;n.xp6(1),n.Q6J("img","plugin.png")("id",t.id)("name",t.name)("title","\u63d2\u4ef6")}}let W=(()=>{class e{constructor(t,o,r,s){this.modal=t,this.router=o,this.rs=r,this.msg=s,this.isVisible=!1,this.loading=!0,this.chooseData={},this.datum=[],this.total=1,this.pageSize=20,this.pageIndex=1,this.query={},this.checked=!1,this.indeterminate=!1,this.setOfCheckedId=new Set,this.delResData=[],this.pageSizeChange(this.pageSize)}reload(){this.datum=[],this.load()}close(){this.isVisible=!1}informate(t){this.isVisible=!0,this.rs.get(`plugin/${t.id}`,this.query).subscribe(o=>{this.chooseData=o.data}).add(()=>{this.loading=!1})}load(){this.loading=!0,this.rs.post("plugin/search",this.query).subscribe(t=>{this.datum=t.data||[],this.total=t.total}).add(()=>{this.loading=!1})}enable(t){this.rs.get(`plugin/${t}/enable`).subscribe(o=>{this.reload()})}disable(t){this.rs.get(`plugin/${t}/disable`).subscribe(o=>{this.reload()})}plugin(t,o){switch(t){case 0:this.rs.get(`plugin/${o}/start`).subscribe(r=>{this.load()});break;case 1:this.rs.get(`plugin/${o}/stop`).subscribe(r=>{this.load()});break;case 2:this.rs.get(`plugin/${o}/restart`).subscribe(r=>{this.load()})}}create(){let t="/plugin/create";location.pathname.startsWith("/admin")&&(t="/admin"+t),this.router.navigateByUrl(t)}handleExport(){this.href="/api/plugin/export"}delete(t,o){this.rs.get(`plugin/${t}/delete`).subscribe(r=>{o?o&&(this.delResData.push(r),o===this.delResData.length&&(this.msg.success("\u5220\u9664\u6210\u529f"),this.load())):(this.msg.success("\u5220\u9664\u6210\u529f"),this.datum=this.datum.filter(s=>s.id!==t))})}onQuery(t){(0,y.r)(t,this.query),this.load()}pageIndexChange(t){this.query.skip=t-1,this.load()}pageSizeChange(t){this.query.limit=t,this.load()}search(t){this.query.keyword={name:t},this.query.skip=0,this.load()}cancel(){this.msg.info("\u53d6\u6d88\u64cd\u4f5c")}handleEdit(t){this.isVisible=!1;const r=this.modal.create({nzTitle:t?"\u7f16\u8f91\u63d2\u4ef6":"\u521b\u5efa\u63d2\u4ef6",nzStyle:{top:"20px"},nzContent:d,nzComponentParams:{id:t},nzFooter:[{label:"\u53d6\u6d88",onClick:()=>{r.destroy()}},{label:"\u4fdd\u5b58",type:"primary",onClick:s=>{s.submit().then(()=>{r.destroy(),this.load()},()=>{})}}]})}handleBatchDel(){(0,g.mK)(this)}handleAllChecked(t){(0,g.Yk)(t,this)}handleItemChecked(t,o){(0,g.mp)(t,o,this)}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(P.Sf),n.Y36(c.F0),n.Y36(_.s),n.Y36(C.dD))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-plugins"]],decls:11,vars:8,consts:[["nz-button","","nzType","primary",3,"click",4,"nzSpaceItem"],[3,"onSearch",4,"nzSpaceItem"],["nz-button","","nzType","primary","class","btn",4,"nzSpaceItem"],[3,"url",4,"nzSpaceItem"],["nz-row","",1,"card",3,"nzGutter"],["nz-col","","class","card-item",3,"click",4,"ngFor","ngForOf"],[3,"isVisible","title","chooseData","edit","delete","close"],["nzShowSizeChanger","",2,"position","fixed","bottom","0","right","10px",3,"nzPageIndex","nzTotal","nzPageSize","nzPageSizeChange","nzPageIndexChange"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","reload",3,"nzSpin"],[3,"onSearch"],["nz-icon","","nzType","plus"],["nz-button","","nzType","primary",1,"btn"],["nz-icon","","nzType","cloud-download","nzTheme","outline"],["download","filename",3,"href","click"],[3,"url"],["nz-col","",1,"card-item",3,"click"],[3,"img","id","name","title"]],template:function(t,o){1&t&&(n.TgZ(0,"app-toolbar")(1,"nz-space"),n.YNc(2,K,3,1,"button",0),n.YNc(3,V,1,0,"app-search-box",1),n.YNc(4,G,3,0,"button",0),n.YNc(5,H,4,1,"button",2),n.YNc(6,R,1,1,"app-import",3),n.qZA()(),n.TgZ(7,"div",4),n.YNc(8,k,2,4,"div",5),n.qZA(),n.TgZ(9,"app-detail",6),n.NdJ("edit",function(s){return o.handleEdit(s)})("delete",function(s){return o.delete(s)})("close",function(){return o.close()}),n.qZA(),n.TgZ(10,"nz-pagination",7),n.NdJ("nzPageSizeChange",function(s){return o.pageSizeChange(s)})("nzPageIndexChange",function(s){return o.pageIndexChange(s)}),n.qZA()),2&t&&(n.xp6(7),n.Q6J("nzGutter",16),n.xp6(1),n.Q6J("ngForOf",o.datum),n.xp6(1),n.Q6J("isVisible",o.isVisible)("title","\u63d2\u4ef6")("chooseData",o.chooseData),n.xp6(1),n.Q6J("nzPageIndex",o.pageIndex)("nzTotal",o.total)("nzPageSize",o.pageSize))},dependencies:[m.sg,b.Ls,S.dE,p.t3,p.SK,v.ix,D.w,I.dQ,M.n,Y.B,B.k,O.A,$.J,z.NU,z.$1],styles:[".btn[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:82px;height:32px;border-radius:3px}.btn[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;margin-left:5px;font-size:14px}.card[_ngcontent-%COMP%]{box-sizing:border-box;padding:10px 20px;width:100%}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]{box-sizing:border-box;padding:5px}.card[_ngcontent-%COMP%]   .card-item[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),e})();var q=i(1346);const L=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:W},{path:"detail/:id",component:(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-plugin-detail"]],decls:2,vars:0,template:function(t,o){1&t&&(n.TgZ(0,"p"),n._uU(1,"plugin-detail works!"),n.qZA())}}),e})()},{path:"edit/:id",component:d},{path:"create",component:d},{path:"**",component:q.r}];let w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[c.Bz.forChild(L),c.Bz]}),e})();var j=i(8284),nn=i(3325),tn=i(1971),en=i(7096),on=i(9166),rn=i(269),an=i(2577),sn=i(6497),ln=i(6672),un=i(8521);let pn=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[m.ez,w,j.wm,nn.ip,b.PV,tn.vh,S.uK,P.Qp,u.U5,sn._p,ln.X,l.UX,x.o7,en.Zf,v.sL,on.Y,z.zf,rn.HQ,an.S,T.m,un.aF,Z.Wr]}),e})()}}]);